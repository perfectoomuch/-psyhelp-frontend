var A=Object.defineProperty;var H=(e,t,r)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var v=(e,t,r)=>H(e,typeof t!="symbol"?t+"":t,r);import{d as N,h as z,_ as R,a as M,c as n,o,b as p,e as F,r as c,F as h,f as d,g as b,n as k,i as w,w as _,j as q,t as g,k as $,v as E,l as G,C as Q,L as J,u as K,m as O}from"./index-CqT2QNuy.js";import{_ as W}from"./Header.vue_vue_type_script_setup_true_lang-CKGwYuTd.js";import{B as X,S as Y}from"./SpecialistsLoop-S5MzwOsK.js";import{_ as Z,a as j,b as ee,c as te,d as se,e as re,f as oe}from"./SelectValue.vue_vue_type_script_setup_true_lang-4sVmtXiY.js";import"./utils-B0VsVXUT.js";import"./emitUp-BKutWrD2.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Cfpa6dAJ.js";const C=N("filterSpecialists",{state:()=>({specialists:[],loading:!0}),actions:{updateSpecialists(e){this.specialists=e,this.loading=!1}}});class ie{constructor(){v(this,"store",C())}async fetchSpecialistsByFilter(t){try{const r=await z.post("specialists/filter-by-bid",t);this.store.updateSpecialists(r.data)}catch(r){console.log(r)}}}const ae=M({name:"HomePage",components:{Header:W,ListFilter:J,ChevronDown:Q,SpecialistsLoop:Y,Select:oe,SelectContent:re,SelectGroup:se,SelectItem:te,SelectLabel:ee,SelectTrigger:j,SelectValue:Z},data:()=>({preFilterForm:[],afterFilterForm:[],preFilterFormPayload:[],filterFormShow:!1,specialistsService:new ie,bidService:new X,tab:"form",filterFormToggle:!1}),async created(){await Promise.all(this.questionsStore.questions.map(e=>{this.preFilterForm.push({local_id:e.id,question:e.question,answer:[],field:e.field})})),await Promise.all(this.questionsStore.filters.map(e=>{this.afterFilterForm.push({local_id:e.id,question:e.question,answer:"",field:e.field})})),this.filterFormShow=!0,this.preFilterForm=[{local_id:1e3,question:"Что вы чувствуете?",answer:["Тревога, стресс"],field:""},{local_id:1001,question:"Какие у вас проблемы?",answer:["Прокрастинация, перфекционизм"],field:""},{local_id:1002,question:"Что с вами произошло?",answer:"Семейные или партнерские конфликты",field:""},{local_id:1003,question:"Предпочтения по полу специалиста",answer:"Неважно",field:"gender"},{local_id:1004,question:"Возраст психолога",answer:"Неважно",field:"age"},{local_id:1005,question:"Опыт работы",answer:"Неважно",field:"experience_years"},{local_id:1007,question:"Бюджет на сессию",answer:"От 5000 до 10000 ₽",field:"price"},{local_id:1008,question:"Опыт работы с этническими группами",answer:"Неважно",field:"experience_ethnic_group"}]},computed:{questionsStore(){return O()},specialistsStore(){return C()},userStore(){return K()},tabResultClass(){if(this.tab==="result"){if(this.filterFormToggle)return"flex";if(!this.filterFormToggle)return"hidden"}else return"flex"}},methods:{async onFilter(){const e=this.preFilterForm.findIndex(r=>r.answer.length===0),t=this.preFilterForm[e];if(e>-1)t.select==="multiple"?this.$toast.error("Выберите хотя бы одну"):this.$toast.error("Выберите параметр"),document.querySelector(`#card-${e}`).scrollIntoView({behavior:"smooth"});else{const r=this.preFilterForm.map(a=>Array.isArray(a.answer)?a:typeof a.answer=="string"?{...a,answer:[a.answer]}:a);this.filterFormPayload=r,await this.specialistsService.fetchSpecialistsByFilter(r),this.tab="result",window.scrollTo({top:0,behavior:"auto"}),this.afterFilterForm.map(a=>{const s=this.preFilterForm.find(m=>m.local_id===a.local_id);if(s){const m=this.afterFilterForm.findIndex(S=>S.local_id===a.local_id);this.afterFilterForm[m].answer=s.answer}})}},async onBooking(e){const t={...e,form:this.filterFormPayload,chat_id:this.userStore.user.chat_id};return await this.bidService.createBid(t)},async onChangeFilter(){const a=[...this.preFilterForm.map(s=>Array.isArray(s.answer)?s:typeof s.answer=="string"?{...s,answer:[s.answer]}:s).filter(s=>!this.afterFilterForm.some(m=>m.local_id===s.local_id)),...this.afterFilterForm].map(s=>Array.isArray(s.answer)?s:typeof s.answer=="string"?{...s,answer:s.answer.length>0?[s.answer]:[""]}:s);await this.specialistsService.fetchSpecialistsByFilter(a),this.tab="result",window.scrollTo({top:0,behavior:"auto"})}}}),le={key:0,class:"flex flex-col gap-2 mb-4"},ne={class:"grid grid-cols-2 gap-2"},ce=["id"],de={class:"card-body"},ue={class:"card-title"},pe={class:"grid grid-cols-1 gap-2"},me=["for"],fe=["id","onUpdate:modelValue","value"],he=["id","onUpdate:modelValue","value"],Fe={class:"text-sm"};function _e(e,t,r,a,s,m){const S=c("Header"),V=c("ListFilter"),T=c("ChevronDown"),B=c("SelectValue"),L=c("SelectTrigger"),D=c("SelectLabel"),x=c("SelectItem"),P=c("SelectContent"),I=c("Select"),U=c("SpecialistsLoop");return o(),n(h,null,[p(S,{title:"Подобрать психолога",description:"Ответьте на следующие вопросы и мы подберем Вам психолога"}),e.filterFormShow?(o(),n(h,{key:0},[e.tab==="result"?(o(),n("div",le,[d("div",{class:"h-[48px] card w-full bg-base-100 rounded-lg flex items-center flex-row px-4 font-semibold shadow-sm",onClick:t[0]||(t[0]=l=>e.filterFormToggle=!e.filterFormToggle)},[p(V,{class:"size-4 mr-2"}),t[2]||(t[2]=d("span",null,"Параметры фильтра",-1)),p(T,{class:k(["size-4 ml-auto duration-300",e.filterFormToggle&&"rotate-180"])},null,8,["class"])]),d("div",ne,[(o(!0),n(h,null,w(e.questionsStore.filters,(l,i)=>(o(),b(I,{key:i,modelValue:e.afterFilterForm[i].answer,"onUpdate:modelValue":[u=>e.afterFilterForm[i].answer=u,e.onChangeFilter]},{default:_(()=>[p(L,{class:"bg-white border-none shadow-md w-full"},{default:_(()=>[p(B,{placeholder:l.question},null,8,["placeholder"])]),_:2},1024),p(P,{class:"bg-white border-gray-200 max-h-[400px]"},{default:_(()=>[p(D,null,{default:_(()=>[q(g(l.question),1)]),_:2},1024),(o(!0),n(h,null,w(l.variants,(u,f)=>(o(),b(x,{key:f,value:u},{default:_(()=>[q(g(u),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))])])):F("",!0),d("div",{class:k(["flex-col gap-2",e.tabResultClass])},[(o(!0),n(h,null,w(e.questionsStore.questions,(l,i)=>(o(),n("div",{key:i,id:`card-${i}`,class:"card w-full bg-base-100 card-sm shadow-sm rounded-xl"},[d("div",de,[d("h2",ue,g(l.question),1),d("div",pe,[(o(!0),n(h,null,w(l.variants,(u,f)=>(o(),n("div",{key:f},[d("label",{for:`checkbox-${i}-${f}`,class:"flex items-center gap-2 py-3 px-2 border border-gray-200 rounded-lg cursor-pointer"},[l.select==="multiple"?$((o(),n("input",{key:0,type:"checkbox",id:`checkbox-${i}-${f}`,"onUpdate:modelValue":y=>e.preFilterForm[i].answer=y,value:u,class:"checkbox checkbox-xs checkbox-primary"},null,8,fe)),[[E,e.preFilterForm[i].answer]]):F("",!0),l.select==="single"?$((o(),n("input",{key:1,type:"radio",id:`checkbox-${i}-${f}`,"onUpdate:modelValue":y=>e.preFilterForm[i].answer=y,value:u,class:"radio radio-xs radio-primary"},null,8,he)),[[G,e.preFilterForm[i].answer]]):F("",!0),d("p",Fe,g(u),1)],8,me)]))),128))])])],8,ce))),128)),d("button",{class:"btn btn-lg w-full text-sm uppercase tracking-wide btn-primary",onClick:t[1]||(t[1]=(...l)=>e.onFilter&&e.onFilter(...l))}," Подобрать психолога ")],2),e.tab==="result"?(o(),b(U,{key:1,specialists:e.specialistsStore.specialists,loading:e.specialistsStore.loading},null,8,["specialists","loading"])):F("",!0)],64)):F("",!0)],64)}const $e=R(ae,[["render",_e]]);export{$e as default};
