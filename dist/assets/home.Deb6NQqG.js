import{a as y,f as h,o as l,w as o,G as B,E as d,D as w,b as a,e as s,X as J,c as i,n as k,_ as K,ai as R,g as _,J as X,j as Q,r as c,l as W,F as b,i as M,q as g,t as u,ah as Z}from"./index.CY1TeMWG.js";import{_ as ee,a as se,b as te}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang.DoyR2h-P.js";import{g as ne,p as ae}from"./specialist.B1-3R11H.js";import{_ as oe,a as le,b as re,c as ie,d as de,e as ue}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang.CmDxb9qS.js";import{a as H,_ as pe,r as x,e as ce,b as C,f as me,g as fe,h as ge,j as _e,k as be}from"./utils.BQ_vfMpE.js";import{g as he}from"./DialogTrigger.vue_vue_type_script_setup_true_lang.DgG1nC5z.js";import{I as ve}from"./InvoiceDialog.oHEv_IMJ.js";import{g as ye}from"./allStatus.CybyXbRd.js";import"./useTypeahead.kq2uD7pL.js";import"./transaction.service.LBUcJe1W.js";import"./specialist.service.DZ9MwJva.js";const we=[{value:"in_agreement",name:"В согласовании"},{value:"cancelled",name:"Отменено"},{value:"confirmed",name:"Подтверждено"}],Be=t=>{switch(t){case"in_agreement":return"В согласовании";case"cancelled":return"Отменено";case"confirmed":return"Подтверждено"}},Se=y({__name:"Sheet",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(t,{emit:e}){const v=H(t,e);return(r,m)=>(l(),h(d(pe),B({"data-slot":"sheet"},d(v)),{default:o(()=>[w(r.$slots,"default")]),_:3},16))}}),De=y({__name:"SheetOverlay",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,p=x(e,"class");return(f,v)=>(l(),h(d(ce),B({"data-slot":"sheet-overlay",class:d(C)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",e.class)},d(p)),{default:o(()=>[w(f.$slots,"default")]),_:3},16,["class"]))}}),$e=y({inheritAttrs:!1,__name:"SheetContent",props:{class:{},side:{default:"right"},forceMount:{type:Boolean},trapFocus:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(t,{emit:e}){const p=t,f=e,v=x(p,"class","side"),r=H(v,f);return(m,S)=>(l(),h(d(he),null,{default:o(()=>[a(De),a(d(fe),B({"data-slot":"sheet-content",class:d(C)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",m.side==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",m.side==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",m.side==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",m.side==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",p.class)},{...d(r),...m.$attrs}),{default:o(()=>[w(m.$slots,"default"),a(d(me),{class:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none"},{default:o(()=>[a(d(J),{class:"size-4"}),S[0]||(S[0]=s("span",{class:"sr-only"},"Close",-1))]),_:1,__:[0]})]),_:3},16,["class"])]),_:3}))}}),ke=y({__name:"SheetDescription",props:{asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,p=x(e,"class");return(f,v)=>(l(),h(d(ge),B({"data-slot":"sheet-description",class:d(C)("text-muted-foreground text-sm",e.class)},d(p)),{default:o(()=>[w(f.$slots,"default")]),_:3},16,["class"]))}}),Ce=y({__name:"SheetHeader",props:{class:{}},setup(t){const e=t;return(p,f)=>(l(),i("div",{"data-slot":"sheet-header",class:k(d(C)("flex flex-col gap-1.5 p-4",e.class))},[w(p.$slots,"default")],2))}}),Me=y({__name:"SheetTitle",props:{asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,p=x(e,"class");return(f,v)=>(l(),h(d(_e),B({"data-slot":"sheet-title",class:d(C)("text-foreground font-semibold",e.class)},d(p)),{default:o(()=>[w(f.$slots,"default")]),_:3},16,["class"]))}}),xe=y({__name:"SheetTrigger",props:{asChild:{type:Boolean},as:{}},setup(t){const e=t;return(p,f)=>(l(),h(d(be),B({"data-slot":"sheet-trigger"},e),{default:o(()=>[w(p.$slots,"default")]),_:3},16))}}),Ie={components:{Popover:te,PopoverContent:se,PopoverTrigger:ee,DropdownMenu:ue,DropdownMenuContent:de,DropdownMenuItem:ie,DropdownMenuLabel:re,DropdownMenuSeparator:le,DropdownMenuTrigger:oe,Sheet:Se,SheetContent:$e,SheetDescription:ke,SheetHeader:Ce,SheetTitle:Me,SheetTrigger:xe,InvoiceDialog:ve},data:()=>({bidService:new R,loading:!0,bids:[],search:{text:"",used:!1,result:""},currentBid:null,drawerOpen:!1,drawerLoading:!0,profession:ae,getRoute:ne,getStatus:Be,getStatusList:we,getOneStatusByValue:ye}),async created(){await this.getAll()},computed:{methodStore(){return Z()},bidsMap(){return this.search.used?this.search.result:this.bids}},methods:{getProfession(t){return this.profession(t).getProfessionByValue.map(e=>e.name).join(", ")},async getAll(){this.bids=await this.bidService.getAll(),this.loading=!1},async updateBidStatusById(t,e){var p;await this.bidService.updateStatusById(t,e),await this.getAll(),t===((p=this.currentBid)==null?void 0:p.id)&&await this.openBid(t)},async openBid(t){this.drawerOpen=!0,this.drawerLoading=!0,this.currentBid=await this.bidService.getById(t),this.drawerLoading=!1},async onSearch(){if(this.search.text.trim().length===0){this.search.result=[],this.search.used=!1;return}this.search.result=await this.bidService.getBySearch(this.search.text),this.search.used=!0},onOpenInvoice(){this.$refs.invoiceDialog.openAction(!0,{customer:this.currentBid.customer,specialist:this.currentBid.specialist})},getOneStatus(t){const e=this.getOneStatusByValue(t);return e?e.class:""}}},Oe={class:"flex justify-between"},Pe={class:"input border"},Te={key:0,class:"flex justify-center"},je={key:1,role:"alert",class:"alert"},Le={key:2,class:"overflow-x-auto"},Ye={class:"table table-sm"},ze={class:"text-xs opacity-55"},Ae={class:"whitespace-nowrap text-primary cursor-pointer"},He={class:"grid gap-4"},Ve={class:"space-y-2"},Ee={class:"text-sm font-medium leading-none"},Fe={class:"grid gap-2"},Ne={class:"grid grid-cols-3 items-center gap-4 text-xs"},qe={class:"col-span-2"},Ue={class:"col-span-2 text-primary"},Ge=["href"],Je={class:"col-span-2"},Ke={class:"whitespace-nowrap text-primary cursor-pointer"},Re={class:"grid gap-4"},Xe={class:"space-y-2"},Qe={class:"text-sm font-medium leading-none"},We={class:"grid gap-2"},Ze=["src"],es={class:"grid grid-cols-3 items-center gap-4 text-sm"},ss={class:"col-span-2"},ts={class:"col-span-2"},ns=["onClick"],as={key:0,class:"flex items-center justify-center flex-1"},os={class:"px-4 pb-4 flex flex-col gap-4 w-full"},ls={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},rs=["value"],is=["value"],ds={class:"relative"},us=["value"],ps={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},cs=["value"],ms=["value"],fs=["value"],gs=["value"],_s={key:0,class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},bs={class:"label"},hs=["value"],vs=["value"],ys={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},ws=["src"],Bs=["value"],Ss=["value"],Ds=["value"];function $s(t,e,p,f,v,r){const m=c("Icon"),S=c("PopoverTrigger"),O=c("PopoverContent"),P=c("Popover"),I=c("router-link"),T=c("DropdownMenuTrigger"),j=c("DropdownMenuLabel"),L=c("DropdownMenuSeparator"),Y=c("DropdownMenuItem"),z=c("DropdownMenuContent"),A=c("DropdownMenu"),V=c("SheetTitle"),E=c("SheetDescription"),F=c("SheetHeader"),N=c("SheetContent"),q=c("Sheet"),U=c("InvoiceDialog");return l(),i(b,null,[s("div",Oe,[e[5]||(e[5]=s("h1",{class:"text-2xl font-semibold mb-10"},"Все заявки",-1)),s("form",{onSubmit:e[1]||(e[1]=X((...n)=>r.onSearch&&r.onSearch(...n),["prevent"])),class:"flex gap-2"},[s("label",Pe,[a(m,{name:"Search",size:16}),Q(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.search.text=n),type:"text",class:"grow",placeholder:"id, email, username"},null,512),[[W,t.search.text]])]),e[4]||(e[4]=s("button",{class:"btn"},"Поиск",-1))],32)]),t.loading?(l(),i("div",Te,e[6]||(e[6]=[s("span",{class:"loading loading-spinner text-primary"},null,-1)]))):_("",!0),!t.loading&&r.bidsMap.length===0?(l(),i("div",je,[a(m,{name:"Info",class:"min-size-4 text-primary"}),e[7]||(e[7]=s("span",null,"На данный момент нет заявок. Вернитесь позже",-1))])):_("",!0),!t.loading&&r.bidsMap.length>0?(l(),i("div",Le,[s("table",Ye,[e[19]||(e[19]=s("thead",null,[s("tr",null,[s("th",{class:"font-medium"},"Создано"),s("th",{class:"font-medium"},"Клиент"),s("th",{class:"font-medium"},"Специалист"),s("th",{class:"font-medium"},"Желаемая дата"),s("th",{class:"font-medium"},"Статус"),s("th",{class:"font-medium"},"Детали заявки")])],-1)),s("tbody",null,[(l(!0),i(b,null,M(r.bidsMap,(n,D)=>(l(),i("tr",{key:D},[s("td",null,[g(u(t.$dayjs(n.created_at).format("DD-MM-YYYY HH:mm:ss"))+" ",1),e[8]||(e[8]=s("br",null,null,-1)),s("span",ze,u(n.id),1)]),s("td",null,[a(P,null,{default:o(()=>[a(S,{"as-child":""},{default:o(()=>[s("span",Ae,u(n.customer.first_name),1)]),_:2},1024),a(O,{class:"w-80"},{default:o(()=>[s("div",He,[s("div",Ve,[s("h4",Ee," ID: "+u(n.customer.id),1),e[9]||(e[9]=s("p",{class:"text-sm text-muted-foreground"}," Информация о клиенте ",-1))]),s("div",Fe,[s("div",Ne,[e[11]||(e[11]=s("span",null,"Email",-1)),s("span",qe,u(n.customer.email),1),n.customer.username?(l(),i(b,{key:0},[e[10]||(e[10]=s("span",null,"Username",-1)),s("span",Ue,[s("a",{href:`https://t.me/${n.customer.username}`}," @"+u(n.customer.username),9,Ge)])],64)):_("",!0),e[12]||(e[12]=s("span",null,"Chat ID",-1)),s("span",Je,u(n.customer.chat_id),1)])]),e[13]||(e[13]=s("button",{class:"btn w-full btn-primary"}," Отправить сообщение ",-1))])]),_:2},1024)]),_:2},1024)]),s("td",null,[a(P,null,{default:o(()=>[a(S,{"as-child":""},{default:o(()=>[s("span",Ke,u(n.specialist.first_name)+" "+u(n.specialist.last_name),1)]),_:2},1024),a(O,{class:"w-80"},{default:o(()=>[s("div",Re,[s("div",Xe,[s("h4",Qe," ID: "+u(n.specialist.id),1),e[14]||(e[14]=s("p",{class:"text-sm text-muted-foreground"}," Информация о специалисте ",-1))]),s("div",We,[n.specialist.photo?(l(),i("img",{key:0,src:t.$file(n.specialist.photo),alt:"",class:"w-[90px] h-[90px] rounded-lg mb-2 object-cover"},null,8,Ze)):_("",!0),s("div",es,[e[15]||(e[15]=s("span",null,"Профессия",-1)),s("span",ss,u(r.getProfession(n.specialist.profession)),1),e[16]||(e[16]=s("span",null,"Цена",-1)),s("span",ts,u(t.$currency(n.specialist.price)),1)])]),a(I,{to:`/admin/dashboard/specialists/${n.specialist.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[17]||(e[17]=[g(" Открыть профиль ")])),_:2,__:[17]},1032,["to"])])]),_:2},1024)]),_:2},1024)]),s("td",null,u(n.date),1),s("td",null,[a(A,null,{default:o(()=>[a(T,null,{default:o(()=>[s("span",{class:k(["whitespace-nowrap flex items-center gap-2",r.getOneStatus(n.status)])},[g(u(t.getStatus(n.status))+" ",1),a(m,{name:"ChevronDown",size:14})],2)]),_:2},1024),a(z,null,{default:o(()=>[a(j,{class:"text-sm"},{default:o(()=>e[18]||(e[18]=[g(" Изменить статус ")])),_:1,__:[18]}),a(L),(l(!0),i(b,null,M(t.getStatusList,($,G)=>(l(),h(Y,{key:G,class:k(["hover:bg-gray-100",r.getOneStatus($.value)]),onClick:ks=>r.updateBidStatusById(n.id,$.value)},{default:o(()=>[g(u($.name),1)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),s("td",null,[s("button",{class:"btn btn-sm w-full",onClick:$=>r.openBid(n.id)}," Открыть ",8,ns)])]))),128))])])])):_("",!0),a(q,{open:t.drawerOpen,"onUpdate:open":e[3]||(e[3]=n=>t.drawerOpen=n)},{default:o(()=>[a(N,{class:"overflow-y-scroll flex flex-col"},{default:o(()=>[t.drawerLoading?(l(),i("div",as,e[20]||(e[20]=[s("span",{class:"loading loading-spinner text-primary"},null,-1)]))):_("",!0),!t.drawerLoading&&t.currentBid!==null?(l(),i(b,{key:1},[a(F,null,{default:o(()=>[a(V,{class:"leading-none"},{default:o(()=>[g(" ID: "+u(t.currentBid.id),1)]),_:1}),a(E,null,{default:o(()=>e[21]||(e[21]=[g("Заявка на сессию")])),_:1,__:[21]})]),_:1}),s("div",os,[s("fieldset",ls,[e[23]||(e[23]=s("legend",{class:"fieldset-legend"},"Детали заявки",-1)),e[24]||(e[24]=s("label",{class:"label"},"Создано",-1)),s("input",{class:"input border",value:t.$dayjs(t.currentBid.created_at).format("DD-MM-YYYY HH:mm:ss"),readonly:""},null,8,rs),e[25]||(e[25]=s("label",{class:"label"},"Желаемая дата на сессию (по мск)",-1)),s("input",{class:"input border",value:t.currentBid.date,readonly:""},null,8,is),e[26]||(e[26]=s("label",{class:"label"},"Статус",-1)),s("div",ds,[s("input",{class:k(["input border",r.getOneStatus(t.currentBid.status)]),value:t.getStatus(t.currentBid.status),readonly:""},null,10,us),a(A,null,{default:o(()=>[a(T,{class:"btn btn-sm btn-square absolute top-1/2 right-2",style:{transform:"translateY(-50%) !important"}},{default:o(()=>[a(m,{name:"ChevronDown",size:16})]),_:1}),a(z,{side:"bottom",align:"end"},{default:o(()=>[a(j,{class:"text-sm"},{default:o(()=>e[22]||(e[22]=[g(" Изменить статус ")])),_:1,__:[22]}),a(L),(l(!0),i(b,null,M(t.getStatusList,(n,D)=>(l(),h(Y,{key:D,class:k(["hover:bg-gray-100",r.getOneStatus(n.value)]),onClick:$=>r.updateBidStatusById(t.currentBid.id,n.value)},{default:o(()=>[g(u(n.name),1)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1})]),s("button",{class:"btn btn-accent",onClick:e[2]||(e[2]=(...n)=>r.onOpenInvoice&&r.onOpenInvoice(...n))}," Выставить счет на оплату ")]),s("fieldset",ps,[e[28]||(e[28]=s("legend",{class:"fieldset-legend"},"Клиент",-1)),e[29]||(e[29]=s("label",{class:"label"},"Имя",-1)),s("input",{class:"input border",value:t.currentBid.customer.first_name,readonly:""},null,8,cs),e[30]||(e[30]=s("label",{class:"label"},"Фамилия",-1)),s("input",{class:"input border",value:t.currentBid.customer.last_name,readonly:""},null,8,ms),e[31]||(e[31]=s("label",{class:"label"},"Email",-1)),s("input",{class:"input border",value:t.currentBid.customer.email},null,8,fs),e[32]||(e[32]=s("label",{class:"label"},"Telegram username",-1)),s("input",{class:"input border",value:t.currentBid.customer.username},null,8,gs),a(I,{to:`/admin/dashboard/chats?customer=${t.currentBid.customer.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[27]||(e[27]=[g(" Написать сообщение ")])),_:1,__:[27]},8,["to"])]),t.currentBid.body.length>0?(l(),i("fieldset",_s,[e[33]||(e[33]=s("legend",{class:"fieldset-legend"},"Опрос",-1)),(l(!0),i(b,null,M(t.currentBid.body,(n,D)=>(l(),i(b,{key:D},[s("label",bs,u(n.question),1),n.answer.length<=2?(l(),i("input",{key:0,class:"input border",value:n.answer.join(", "),readonly:""},null,8,hs)):(l(),i("textarea",{key:1,class:"textarea w-full",value:n.answer.join(`
`),placeholder:"Bio"},null,8,vs))],64))),128))])):_("",!0),s("fieldset",ys,[e[35]||(e[35]=s("legend",{class:"fieldset-legend"},"Специалист",-1)),t.currentBid.specialist.photo?(l(),i("img",{key:0,src:t.$file(t.currentBid.specialist.photo),alt:"",class:"w-[100px] h-[100px] object-cover rounded-lg mb-2"},null,8,ws)):_("",!0),e[36]||(e[36]=s("label",{class:"label"},"Имя",-1)),s("input",{class:"input border",value:`${t.currentBid.specialist.first_name} ${t.currentBid.specialist.last_name}`,readonly:""},null,8,Bs),e[37]||(e[37]=s("label",{class:"label"},"Цена",-1)),s("input",{class:"input border",value:t.$currency(t.currentBid.specialist.price)},null,8,Ss),e[38]||(e[38]=s("label",{class:"label"},"Сессии было",-1)),s("input",{class:"input border",value:t.currentBid.specialist.sessions},null,8,Ds),a(I,{to:`/admin/dashboard/specialists/${t.currentBid.specialist.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[34]||(e[34]=[g(" Открыть ")])),_:1,__:[34]},8,["to"])])])],64)):_("",!0)]),_:1})]),_:1},8,["open"]),a(U,{ref:"invoiceDialog"},null,512)],64)}const As=K(Ie,[["render",$s]]);export{As as default};
