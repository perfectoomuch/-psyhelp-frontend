var B=Object.defineProperty;var q=(e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var F=(e,t,r)=>q(e,typeof t!="symbol"?t+"":t,r);import{d as V,h as I,_ as T,a as E,c as i,o,b as w,e as n,f as g,g as p,r as d,w as b,F as h,i as S,j as f,v as N,k as P,t as L,l as U,n as v,N as A,S as H,m as M,C as D,L as Q,u as R,p as z}from"./index-DlouWDH6.js";import{_ as G}from"./Header.vue_vue_type_script_setup_true_lang-C5oWvQh9.js";import{B as x,S as J}from"./SpecialistsLoop-RF0GaorC.js";import{_ as K,a as O,b as W,c as X,d as Y,e as Z,f as j}from"./SelectValue.vue_vue_type_script_setup_true_lang-B1GvedFt.js";import"./DialogPortal-eiBcyfpc.js";import"./utils-qwHvG82s.js";import"./emitUp-BKutWrD2.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Bt4G_JXU.js";import"./index-BBhC-Yv9.js";const _=V("filterSpecialists",{state:()=>({specialists:[],loading:!0}),actions:{updateSpecialists(e){this.specialists=e,this.loading=!1}}});class ee{constructor(){F(this,"store",_())}async fetchSpecialistsByFilter(t){try{const r=await I.post("specialists/filter-by-bid",t);this.store.updateSpecialists(r.data)}catch(r){console.log(r)}}}const te=E({name:"HomePage",components:{Header:G,ListFilter:Q,ChevronDown:D,SpecialistsLoop:J,Select:j,SelectContent:Z,SelectGroup:Y,SelectItem:X,SelectLabel:W,SelectTrigger:O,SelectValue:K,Swiper:M,SwiperSlide:H},data:()=>({swiperInstance:null,modules:[A],activeIndex:0,preFilterForm:[],afterFilterForm:[],preFilterFormPayload:[],filterFormShow:!1,specialistsService:new ee,bidService:new x,tab:"form",filterFormToggle:!1}),async created(){this.getPreFilterForm(),await Promise.all(this.questionsStore.filters.map(e=>{this.afterFilterForm.push({local_id:e.id,question:e.question,answer:"",field:e.field})})),this.filterFormShow=!0},computed:{questionsStore(){return z()},specialistsStore(){return _()},userStore(){return R()},tabResultClass(){if(this.tab==="result"){if(this.filterFormToggle)return"flex";if(!this.filterFormToggle)return"hidden"}else return"flex"},header(){if(this.tab==="form"){const e=this.questionsStore.questions[this.activeIndex];return{title:e.question,description:e.description}}else return{title:"Специалисты по вашим критериям",description:"На основе ваших ответов мы нашли психологов, которые наиболее соответствуют вашему запросу"}}},methods:{onSwiper(e){this.swiperInstance=e},onSlideChange(e){this.activeIndex=e.activeIndex},async getPreFilterForm(){this.preFilterForm=[],await Promise.all(this.questionsStore.questions.map(e=>{this.preFilterForm.push({local_id:e.id,question:e.question,answer:[],field:e.field,enter_variant:e.enter_variant,enter_variant_state:!1,custom_answer:""})}))},async onFilter(){const e=this.preFilterForm.map(t=>{const r=Array.isArray(t.answer)?[...t.answer,t.custom_answer]:[t.answer];return{...t,answer:r.filter(m=>m.length>0)}});this.filterFormPayload=e,await this.specialistsService.fetchSpecialistsByFilter(e),this.tab="result",window.scrollTo({top:0,behavior:"auto"})},async onBooking(e){const t={...e,form:this.filterFormPayload,chat_id:this.userStore.user.chat_id};return await this.bidService.createBid(t)},onChangeAnswer(e){},onEnterVariant(e){this.preFilterForm[e].enter_variant_state=!this.preFilterForm[e].enter_variant_state,this.preFilterForm[e].custom_answer=""},onNextSwiper(){const e=this.preFilterForm[this.activeIndex].answer,t=this.preFilterForm[this.activeIndex].custom_answer;if(this.preFilterForm[this.activeIndex].enter_variant){if(!!(t.length===0&&e.length===0)){this.$toast.error("Выберите хотя бы 1 вариант или введите свой");return}}else if(e.length===0){this.$toast.error("Выберите хотя бы 1 вариант");return}this.swiperInstance.slideNext()},async onBackToQuestions(){await this.getPreFilterForm(),this.swiperInstance.slideTo(0),this.tab="form"}}}),se=["id"],re={class:"grid grid-cols-1 gap-2 pb-1"},oe=["for"],ie=["id","onUpdate:modelValue","value","onChange"],ae=["id","onUpdate:modelValue","value","onChange"],ne={class:"text-sm"},le=["for"],ce=["id","onChange","value"],pe=["disabled","onUpdate:modelValue"],ue={class:"flex gap-2 justify-end mt-2"};function de(e,t,r,m,me,he){const y=d("Header"),k=d("swiper-slide"),C=d("swiper"),$=d("SpecialistsLoop");return o(),i(h,null,[w(y,{title:e.header.title,description:e.header.description,backButtonText:e.tab==="result"?"Заполнить заново":"",onBack:e.onBackToQuestions},null,8,["title","description","backButtonText","onBack"]),n("div",{class:v(["flex-col gap-2",e.tabResultClass])},[w(C,{"slides-per-view":1,"space-between":10,modules:e.modules,navigation:{prevEl:".prevEl"},class:"flex-1 w-full h-full",onSlideChange:e.onSlideChange,onSwiper:e.onSwiper,allowTouchMove:!1,autoHeight:!0},{default:b(()=>[(o(!0),i(h,null,S(e.questionsStore.questions,(a,s)=>(o(),g(k,{key:s},{default:b(()=>[n("div",{id:`card-${s}`,class:"w-full"},[n("div",re,[(o(!0),i(h,null,S(a.variants,(l,u)=>(o(),i("label",{key:u,for:`checkbox-${s}-${u}`,class:"flex items-center gap-2 py-3 px-2 border border-gray-200 rounded-lg cursor-pointer bg-base-100 shadow-sm"},[a.select==="multiple"?f((o(),i("input",{key:0,type:"checkbox",id:`checkbox-${s}-${u}`,"onUpdate:modelValue":c=>e.preFilterForm[s].answer=c,value:l,class:"checkbox checkbox-xs checkbox-primary",onChange:c=>e.onChangeAnswer(s)},null,40,ie)),[[N,e.preFilterForm[s].answer]]):p("",!0),a.select==="single"?f((o(),i("input",{key:1,type:"radio",id:`checkbox-${s}-${u}`,"onUpdate:modelValue":c=>e.preFilterForm[s].answer=c,value:l,class:"radio radio-xs radio-primary",onChange:c=>e.onChangeAnswer(s)},null,40,ae)),[[P,e.preFilterForm[s].answer]]):p("",!0),n("p",ne,L(l),1)],8,oe))),128)),a.enter_variant?(o(),i("label",{key:0,for:`checkbox-${s}-enter`,class:"flex items-center gap-2 py-3 px-2 border border-gray-200 rounded-lg cursor-pointer bg-base-100 shadow-sm"},[n("input",{type:"checkbox",id:`checkbox-${s}-enter`,onChange:l=>e.onEnterVariant(s),value:e.preFilterForm[s].enter_variant_state,class:"checkbox checkbox-xs checkbox-primary"},null,40,ce),t[2]||(t[2]=n("p",{class:"text-sm"},"Ввести свой вариант",-1))],8,le)):p("",!0),e.preFilterForm[s].enter_variant?f((o(),i("input",{key:1,disabled:!e.preFilterForm[s].enter_variant_state,"onUpdate:modelValue":l=>e.preFilterForm[s].custom_answer=l,type:"text",placeholder:"Ввести",class:v(["input w-full bg-white rounded-lg focus:outline-none focus:ring-0 border border-gray-200 shadow-sm h-[46px]",[(e.preFilterForm[s].enter_variant_state,"")]])},null,10,pe)),[[U,e.preFilterForm[s].custom_answer]]):p("",!0)])],8,se)]),_:2},1024))),128))]),_:1},8,["modules","onSlideChange","onSwiper"]),n("div",ue,[t[3]||(t[3]=n("button",{class:"btn prevEl"},"Назад",-1)),e.activeIndex===e.questionsStore.questions.length-1?(o(),i("button",{key:0,class:"btn btn-primary",onClick:t[0]||(t[0]=(...a)=>e.onFilter&&e.onFilter(...a))}," Подобрать психолога ")):(o(),i("button",{key:1,class:"btn btn-primary nextEl",onClick:t[1]||(t[1]=(...a)=>e.onNextSwiper&&e.onNextSwiper(...a))}," Вперед "))])],2),e.tab==="result"?(o(),g($,{key:0,specialists:e.specialistsStore.specialists,loading:e.specialistsStore.loading},null,8,["specialists","loading"])):p("",!0)],64)}const Ce=T(te,[["render",de]]);export{Ce as default};
