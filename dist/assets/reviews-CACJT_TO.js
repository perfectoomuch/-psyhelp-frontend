import{M as X,_ as L,a as x,b as z,c as H,d as R,e as q,f as F}from"./MaterializeDatepicker-3y9FH82b.js";import{S as N,_ as Z,a as ee,b as se,c as te}from"./VueStarRating.common-DU9mygiD.js";import{h as C,a4 as D,_ as O,c,o as r,e as s,b as a,F as b,i as S,q as m,t as u,r as l,w as o,g as h,f as V,J as ae,j as I,l as B,ak as ne}from"./index-Do8ladI-.js";import{p as oe}from"./DialogPortal-ZPs-Fjke.js";import{_ as le,a as ie,b as re}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CQlIJ_7r.js";import{_ as de,a as ue,b as pe,c as me,d as ce,e as fe}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DjRwKgLP.js";import"./utils-DopF4P6a.js";class E{async getAll(){try{return(await C.get("admin/reviews")).data}catch(e){console.log(e),D.error("Ошибка при получении")}}async updateById(e,i){try{const p=await C.post(`admin/reviews/${e}`,i);return D.success("Отзыв обновлен"),!0}catch(p){return console.log(p),D.error("Ошибка при сохранении"),!1}}async deleteById(e){try{const i=await C.post(`admin/reviews/delete/${e}`);return D.success("Отзыв удален"),!0}catch(i){return console.log(i),D.error("Ошибка при удалении"),!1}}}const ve=t=>{const e={moderation:"На модерации",approved:"Опубликовано",failed:"Провален"},i=Object.entries(e).map(f=>({value:f[0],name:f[1]}));let p=null;return Array.isArray(t)||(p=i.find(f=>f.value===t)),Array.isArray(t)&&(p=i.filter(f=>t.includes(f.value))),{obj:e,list:i,getStatusByValue:p}},ge={props:["data"],components:{StarRating:N,Popover:re,PopoverContent:ie,PopoverTrigger:le,DropdownMenu:fe,DropdownMenuContent:ce,DropdownMenuItem:me,DropdownMenuLabel:pe,DropdownMenuSeparator:ue,DropdownMenuTrigger:de,Dialog:F,DialogContent:q,DialogDescription:R,DialogFooter:H,DialogHeader:z,DialogTitle:x,DialogTrigger:L,MaterializeDatepicker:X},data:()=>({reviewService:new E,status:ve,profession:oe,dialog:!1,review:null,reviewSaving:!1,time:""}),computed:{statusList(){return this.status().list}},methods:{getProfession(t){return this.profession(t).getProfessionByValue.map(e=>e.name).join(", ")},onOpen(t){this.review=t,this.dialog=!0;const e=this.$dayjs(this.review.date).format("YYYY-MM-DD HH:mm").split(" "),i=e[0],p=e[1];this.review.date=this.$dayjs(i).toDate(),this.time=p},setReviewStatus(t,e){this.review.status=e},async updateById(){const t=this.review.id,e=this.$dayjs(this.review.date).format("YYYY-MM-DD"),i=this.time,p=this.$dayjs(`${e} ${i}`).toDate(),f={name:this.review.name,stars:this.review.stars,review:this.review.review,status:this.review.status,date:p};await this.reviewService.updateById(t,f)&&this.$emit("update")},async updateReviewStatus(t,e){const i={status:e};await this.reviewService.updateById(t,i)&&this.$emit("update")},async deleteById(t){await this.reviewService.deleteById(t)&&this.$emit("update")}}},_e={class:"overflow-x-auto"},we={class:"table table-sm"},be={class:"text-xs opacity-55"},ye={class:"whitespace-nowrap text-primary cursor-pointer"},De={class:"grid gap-4"},he={class:"space-y-2"},$e={class:"text-sm font-medium leading-none"},Me={class:"grid gap-2"},Te=["src"],ke={class:"grid grid-cols-3 items-center gap-4 text-sm"},Ce={class:"col-span-2"},Se={class:"col-span-2"},Ie={class:"whitespace-nowrap flex items-center gap-2"},Be={class:"flex gap-2"},Ve=["onClick"],Ye=["onClick"],Ue={class:"flex flex-col gap-2"},je={class:"flex flex-col gap-2"},Pe={class:"flex flex-col gap-2"},Ae={class:"flex flex-col gap-2"},Le={class:"flex gap-2"},xe=["value"],ze={class:"flex flex-col gap-2"},He={class:"flex gap-2"},Re=["value"],qe={class:"flex flex-col gap-2"},Fe=["value"],Ne={class:"flex flex-col gap-2"},Oe=["disabled"],Ee={key:0,class:"loading loading-sm loading-spinner"};function Je(t,e,i,p,f,d){const $=l("star-rating"),g=l("PopoverTrigger"),M=l("router-link"),_=l("PopoverContent"),w=l("Popover"),y=l("Icon"),T=l("DropdownMenuTrigger"),Y=l("DropdownMenuLabel"),U=l("DropdownMenuSeparator"),j=l("DropdownMenuItem"),P=l("DropdownMenuContent"),A=l("DropdownMenu"),J=l("MaterializeDatepicker"),G=l("DialogContent"),K=l("Dialog"),Q=ne("maska");return r(),c(b,null,[s("div",_e,[s("table",we,[e[14]||(e[14]=s("thead",null,[s("tr",null,[s("th",{class:"font-medium"},"Дата"),s("th",{class:"font-medium"},"Имя"),s("th",{class:"font-medium"},"Рейтинг"),s("th",{class:"font-medium"},"Специалист"),s("th",{class:"font-medium"},"Статус"),s("th",{class:"font-medium"},"Действие")])],-1)),s("tbody",null,[(r(!0),c(b,null,S(i.data,(n,k)=>(r(),c("tr",{key:k},[s("td",null,[m(u(t.$dayjs(n.created_at).format("DD-MM-YYYY HH:mm:ss"))+" ",1),e[7]||(e[7]=s("br",null,null,-1)),s("span",be,u(n.id),1)]),s("td",null,u(n.name),1),s("td",null,[a($,{rating:n.stars,"onUpdate:rating":v=>n.stars=v,"star-size":18,"show-rating":!1,"read-only":!0},null,8,["rating","onUpdate:rating"])]),s("td",null,[a(w,null,{default:o(()=>[a(g,{"as-child":""},{default:o(()=>[s("span",ye,u(n.specialist.first_name)+" "+u(n.specialist.last_name),1)]),_:2},1024),a(_,{class:"w-80"},{default:o(()=>[s("div",De,[s("div",he,[s("h4",$e," ID: "+u(n.specialist.id),1),e[8]||(e[8]=s("p",{class:"text-sm text-muted-foreground"}," Информация о специалисте ",-1))]),s("div",Me,[n.specialist.photo?(r(),c("img",{key:0,src:t.$file(n.specialist.photo),alt:"",class:"w-[90px] h-[90px] rounded-lg mb-2 object-cover"},null,8,Te)):h("",!0),s("div",ke,[e[9]||(e[9]=s("span",null,"Профессия",-1)),s("span",Ce,u(d.getProfession(n.specialist.profession)),1),e[10]||(e[10]=s("span",null,"Цена",-1)),s("span",Se,u(t.$currency(n.specialist.price)),1)])]),a(M,{to:`/admin/dashboard/specialists/${n.specialist.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[11]||(e[11]=[m(" Открыть профиль ")])),_:2,__:[11]},1032,["to"])])]),_:2},1024)]),_:2},1024)]),s("td",null,[a(A,null,{default:o(()=>[a(T,null,{default:o(()=>[s("span",Ie,[m(u(t.status(n.status).getStatusByValue.name)+" ",1),a(y,{name:"ChevronDown",size:14})])]),_:2},1024),a(P,null,{default:o(()=>[a(Y,{class:"text-sm"},{default:o(()=>e[12]||(e[12]=[m(" Изменить статус ")])),_:1,__:[12]}),a(U),(r(!0),c(b,null,S(d.statusList,(v,W)=>(r(),V(j,{key:W,class:"hover:bg-gray-100",onClick:Ze=>d.updateReviewStatus(n.id,v.value)},{default:o(()=>[m(u(v.name),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),s("td",null,[s("div",Be,[a(w,null,{default:o(()=>[a(g,{class:"btn btn-square btn-sm btn-error btn-soft"},{default:o(()=>[a(y,{name:"Trash",size:16})]),_:1}),a(_,null,{default:o(()=>[e[13]||(e[13]=s("p",{class:"text-sm mb-4"},"Вы точно хотите удалить?",-1)),s("button",{class:"btn btn-sm btn-error w-full",onClick:v=>d.deleteById(n.id)}," Да, удалить ",8,Ve)]),_:2,__:[13]},1024)]),_:2},1024),s("button",{class:"btn btn-square btn-sm btn-primary",onClick:v=>d.onOpen(n)},[a(y,{name:"ExternalLink",size:16})],8,Ye)])])]))),128))])])]),a(K,{open:t.dialog,"onUpdate:open":e[6]||(e[6]=n=>t.dialog=n)},{default:o(()=>[a(G,{class:"w-sm"},{default:o(()=>[t.review!==null?(r(),c("form",{key:0,onSubmit:e[5]||(e[5]=ae((...n)=>d.updateById&&d.updateById(...n),["prevent"])),class:"flex flex-col gap-4"},[s("div",Ue,[e[15]||(e[15]=s("label",{class:"label"},"Имя",-1)),I(s("input",{class:"input border w-full",placeholder:"Имя пользователя","onUpdate:modelValue":e[0]||(e[0]=n=>t.review.name=n),required:""},null,512),[[B,t.review.name]])]),s("div",je,[e[16]||(e[16]=s("label",{class:"label"},"Рейтинг",-1)),a($,{rating:t.review.stars,"onUpdate:rating":e[1]||(e[1]=n=>t.review.stars=n),"star-size":22,"show-rating":!1},null,8,["rating"])]),s("div",Pe,[e[17]||(e[17]=s("label",{class:"label"},"Отзыв",-1)),I(s("textarea",{class:"textarea border min-h-[150px] w-full",placeholder:"Текст отзыва","onUpdate:modelValue":e[2]||(e[2]=n=>t.review.review=n),required:""},null,512),[[B,t.review.review]])]),s("div",Ae,[e[19]||(e[19]=s("label",{class:"label"},"Специалист",-1)),s("div",Le,[s("input",{class:"input border w-full",placeholder:"Ваше имя",value:`${t.review.customer.first_name} ${t.review.customer.last_name}`,disabled:"",readonly:""},null,8,xe),a(M,{to:`/admin/dashboard/specialists/${t.review.specialist.id}`,class:"btn btn-primary"},{default:o(()=>e[18]||(e[18]=[m(" Открыть ")])),_:1,__:[18]},8,["to"])])]),s("div",ze,[e[22]||(e[22]=s("label",{class:"label"},"Статус",-1)),s("div",He,[s("input",{class:"input border w-full",placeholder:"Ваше имя",value:t.status(t.review.status).getStatusByValue.name,disabled:"",readonly:""},null,8,Re),a(A,null,{default:o(()=>[a(T,{class:"btn btn-primary"},{default:o(()=>e[20]||(e[20]=[m(" Выбрать ")])),_:1,__:[20]}),a(P,null,{default:o(()=>[a(Y,{class:"text-sm"},{default:o(()=>e[21]||(e[21]=[m(" Изменить статус ")])),_:1,__:[21]}),a(U),(r(!0),c(b,null,S(d.statusList,(n,k)=>(r(),V(j,{key:k,class:"hover:bg-gray-100",onClick:v=>d.setReviewStatus(t.review.id,n.value)},{default:o(()=>[m(u(n.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})])]),s("div",qe,[e[23]||(e[23]=s("label",{class:"label"},"Дата",-1)),a(J,{modelValue:t.review.date,"onUpdate:modelValue":e[3]||(e[3]=n=>t.review.date=n),allPeriod:!0},{default:o(()=>[s("input",{class:"input border w-full",placeholder:"Дата отзыва",value:t.$dayjs(t.review.date).format("DD MMM YYYY"),readonly:""},null,8,Fe)]),_:1},8,["modelValue"])]),s("div",Ne,[e[24]||(e[24]=s("label",{class:"label"},"Время",-1)),I(s("input",{class:"input border w-full",placeholder:"Время отзыва","onUpdate:modelValue":e[4]||(e[4]=n=>t.time=n)},null,512),[[B,t.time],[Q,"##:##"]])]),s("button",{class:"btn btn-primary w-full btn-soft",type:"submit",disabled:t.reviewSaving},[t.reviewSaving?(r(),c("span",Ee)):(r(),c(b,{key:1},[m(" Сохранить ")],64))],8,Oe)],32)):h("",!0)]),_:1})]),_:1},8,["open"])],64)}const Ge=O(ge,[["render",Je]]),Ke={components:{Dialog:F,DialogContent:q,DialogDescription:R,DialogFooter:H,DialogHeader:z,DialogTitle:x,DialogTrigger:L,Tabs:te,TabsContent:se,TabsList:ee,TabsTrigger:Z,StarRating:N,Table:Ge},data:()=>({reviewService:new E,loading:!0,reviews:null,tab:"moderation"}),created(){this.getAll()},methods:{async getAll(){const t=await this.reviewService.getAll();t&&(this.reviews=t,this.loading=!1)}}},Qe={key:0,class:"flex justify-center"},We={key:1,role:"alert",class:"alert"};function Xe(t,e,i,p,f,d){const $=l("Icon"),g=l("TabsTrigger"),M=l("TabsList"),_=l("Table"),w=l("TabsContent"),y=l("Tabs");return r(),c(b,null,[e[3]||(e[3]=s("div",{class:"flex items-center gap-2 mb-10"},[s("h1",{class:"text-2xl font-semibold"},"Отзывы")],-1)),t.loading?(r(),c("div",Qe,e[1]||(e[1]=[s("span",{class:"loading loading-spinner text-primary"},null,-1)]))):h("",!0),!t.loading&&t.reviews===null?(r(),c("div",We,[a($,{name:"Info",class:"min-size-4 text-primary"}),e[2]||(e[2]=s("span",null,"На данный момент нет отзывов. Вернитесь позже",-1))])):h("",!0),!t.loading&&t.reviews!==null?(r(),V(y,{key:2,class:"w-full",modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=T=>t.tab=T)},{default:o(()=>[a(M,{class:"bg-gray-200/80 mb-5"},{default:o(()=>[a(g,{value:"moderation"},{default:o(()=>[m(" На модерации ("+u(t.reviews.moderation.length)+") ",1)]),_:1}),a(g,{value:"approved"},{default:o(()=>[m(" Опубликовано ("+u(t.reviews.approved.length)+") ",1)]),_:1}),a(g,{value:"failed"},{default:o(()=>[m(" Провален ("+u(t.reviews.failed.length)+") ",1)]),_:1})]),_:1}),a(w,{value:"moderation"},{default:o(()=>[a(_,{data:t.reviews.moderation,onUpdate:d.getAll},null,8,["data","onUpdate"])]),_:1}),a(w,{value:"approved"},{default:o(()=>[a(_,{data:t.reviews.approved,onUpdate:d.getAll},null,8,["data","onUpdate"])]),_:1}),a(w,{value:"failed"},{default:o(()=>[a(_,{data:t.reviews.failed,onUpdate:d.getAll},null,8,["data","onUpdate"])]),_:1})]),_:1},8,["modelValue"])):h("",!0)],64)}const is=O(Ke,[["render",Xe]]);export{is as default};
