import{i as N,q as D,Q as y,E as I,c as L,u as k,P as B,R as U}from"./utils.BQ_vfMpE.js";import{x as E,y as C,af as $,a as S,aL as z,ae as G,aR as F,z as j,aS as K,A as Y,f as q,o as W,w as R,b as H,E as w,D as Q}from"./index.CY1TeMWG.js";function J(e){const t=N({dir:E("ltr")});return C(()=>{var n;return(e==null?void 0:e.value)||((n=t.dir)==null?void 0:n.value)||"ltr"})}function M(){const e=E(),t=C(()=>{var n,o;return["#text","#comment"].includes((n=e.value)==null?void 0:n.$el.nodeName)?(o=e.value)==null?void 0:o.$el.nextElementSibling:D(e)});return{primitiveElement:e,currentElement:t}}const _="data-reka-collection-item";function X(e={}){const{key:t="",isProvider:n=!1}=e,o=`${t}CollectionProvider`;let r;if(n){const i=E(new Map);r={collectionRef:E(),itemMap:i},K(o,r)}else r=$(o);const m=(i=!1)=>{const s=r.collectionRef.value;if(!s)return[];const a=Array.from(s.querySelectorAll(`[${_}]`)),f=Array.from(r.itemMap.value.values()).sort((h,g)=>a.indexOf(h.ref)-a.indexOf(g.ref));return i?f:f.filter(h=>h.ref.dataset.disabled!=="")},d=S({name:"CollectionSlot",setup(i,{slots:s}){const{primitiveElement:a,currentElement:c}=M();return j(c,()=>{r.collectionRef.value=c.value}),()=>F(y,{ref:a},s)}}),v=S({name:"CollectionItem",inheritAttrs:!1,props:{value:{validator:()=>!0}},setup(i,{slots:s,attrs:a}){const{primitiveElement:c,currentElement:f}=M();return z(h=>{if(f.value){const g=G(f.value);r.itemMap.value.set(g,{ref:f.value,value:i.value}),h(()=>r.itemMap.value.delete(g))}}),()=>F(y,{...a,[_]:"",ref:c},s)}}),u=C(()=>Array.from(r.itemMap.value.values())),l=C(()=>r.itemMap.value.size);return{getItems:m,reactiveItems:u,itemMapSize:l,CollectionSlot:d,CollectionItem:v}}const Z="rovingFocusGroup.onEntryFocus",ee={bubbles:!1,cancelable:!0},te={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function oe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function ue(e,t,n){const o=oe(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return te[o]}function ne(e,t=!1){const n=I();for(const o of e)if(o===n||(o.focus({preventScroll:t}),I()!==n))return}function ce(e,t){return e.map((n,o)=>e[(t+o)%e.length])}const[fe,ae]=L("RovingFocusGroup"),de=S({__name:"RovingFocusGroup",props:{orientation:{default:void 0},dir:{},loop:{type:Boolean,default:!1},currentTabStopId:{},defaultCurrentTabStopId:{},preventScrollOnEntryFocus:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["entryFocus","update:currentTabStopId"],setup(e,{expose:t,emit:n}){const o=e,r=n,{loop:m,orientation:d,dir:v}=Y(o),u=J(v),l=k(o,"currentTabStopId",r,{defaultValue:o.defaultCurrentTabStopId,passive:o.currentTabStopId===void 0}),i=E(!1),s=E(!1),a=E(0),{getItems:c,CollectionSlot:f}=X({isProvider:!0});function h(p){const A=!s.value;if(p.currentTarget&&p.target===p.currentTarget&&A&&!i.value){const T=new CustomEvent(Z,ee);if(p.currentTarget.dispatchEvent(T),r("entryFocus",T),!T.defaultPrevented){const b=c().map(x=>x.ref).filter(x=>x.dataset.disabled!==""),O=b.find(x=>x.getAttribute("data-active")===""),P=b.find(x=>x.id===l.value),V=[O,P,...b].filter(Boolean);ne(V,o.preventScrollOnEntryFocus)}}s.value=!1}function g(){setTimeout(()=>{s.value=!1},1)}return t({getItems:c}),ae({loop:m,dir:u,orientation:d,currentTabStopId:l,onItemFocus:p=>{l.value=p},onItemShiftTab:()=>{i.value=!0},onFocusableItemAdd:()=>{a.value++},onFocusableItemRemove:()=>{a.value--}}),(p,A)=>(W(),q(w(f),null,{default:R(()=>[H(w(B),{tabindex:i.value||a.value===0?-1:0,"data-orientation":w(d),as:p.as,"as-child":p.asChild,dir:w(u),style:{outline:"none"},onMousedown:A[0]||(A[0]=T=>s.value=!0),onMouseup:g,onFocus:h,onBlur:A[1]||(A[1]=T=>i.value=!1)},{default:R(()=>[Q(p.$slots,"default")]),_:3},8,["tabindex","data-orientation","as","as-child","dir"])]),_:3}))}});function pe(e){const t=U("",1e3);return{search:t,handleTypeaheadSearch:(r,m)=>{t.value=t.value+r;{const d=I(),v=m.map(a=>{var c,f;return{...a,textValue:((c=a.value)==null?void 0:c.textValue)??((f=a.ref.textContent)==null?void 0:f.trim())??""}}),u=v.find(a=>a.ref===d),l=v.map(a=>a.textValue),i=se(l,t.value,u==null?void 0:u.textValue),s=v.find(a=>a.textValue===i);return s&&s.ref.focus(),s==null?void 0:s.ref}},resetTypeahead:()=>{t.value=""}}}function re(e,t){return e.map((n,o)=>e[(t+o)%e.length])}function se(e,t,n){const r=t.length>1&&Array.from(t).every(l=>l===t[0])?t[0]:t,m=n?e.indexOf(n):-1;let d=re(e,Math.max(m,0));r.length===1&&(d=d.filter(l=>l!==n));const u=d.find(l=>l.toLowerCase().startsWith(r.toLowerCase()));return u!==n?u:void 0}export{de as _,J as a,X as b,pe as c,ne as f,ue as g,fe as i,M as u,ce as w};
