import{a as v,f as h,o as l,w as o,G as B,E as i,D as w,b as a,e as s,X as G,c as r,n as J,_ as K,ae as R,g as b,J as X,j as Q,r as u,l as W,F as g,i as M,q as _,t as p,af as Z}from"./index-DlouWDH6.js";import{_ as ee,a as se,b as te}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-Bt4G_JXU.js";import{_ as ne,g as ae,p as oe}from"./DialogPortal-eiBcyfpc.js";import{_ as le,a as re,b as ie,c as de,d as ue,e as pe}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DZo0TLeB.js";import{a as A,_ as ce,r as C,e as me,b as $,f as fe,g as _e,h as be,j as ge,k as he}from"./utils-qwHvG82s.js";const ye=[{value:"in_agreement",name:"В согласовании"},{value:"cancelled",name:"Отменено"},{value:"confirmed",name:"Подтверждено"}],ve=t=>{switch(t){case"in_agreement":return"В согласовании";case"cancelled":return"Отменено";case"confirmed":return"Подтверждено"}},we=v({__name:"Sheet",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(t,{emit:e}){const y=A(t,e);return(c,f)=>(l(),h(i(ce),B({"data-slot":"sheet"},i(y)),{default:o(()=>[w(c.$slots,"default")]),_:3},16))}}),Be=v({__name:"SheetOverlay",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,d=C(e,"class");return(m,y)=>(l(),h(i(me),B({"data-slot":"sheet-overlay",class:i($)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",e.class)},i(d)),{default:o(()=>[w(m.$slots,"default")]),_:3},16,["class"]))}}),Se=v({inheritAttrs:!1,__name:"SheetContent",props:{class:{},side:{default:"right"},forceMount:{type:Boolean},trapFocus:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(t,{emit:e}){const d=t,m=e,y=C(d,"class","side"),c=A(y,m);return(f,D)=>(l(),h(i(ne),null,{default:o(()=>[a(Be),a(i(_e),B({"data-slot":"sheet-content",class:i($)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",f.side==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",f.side==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",f.side==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",f.side==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",d.class)},{...i(c),...f.$attrs}),{default:o(()=>[w(f.$slots,"default"),a(i(fe),{class:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none"},{default:o(()=>[a(i(G),{class:"size-4"}),D[0]||(D[0]=s("span",{class:"sr-only"},"Close",-1))]),_:1,__:[0]})]),_:3},16,["class"])]),_:3}))}}),$e=v({__name:"SheetDescription",props:{asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,d=C(e,"class");return(m,y)=>(l(),h(i(be),B({"data-slot":"sheet-description",class:i($)("text-muted-foreground text-sm",e.class)},i(d)),{default:o(()=>[w(m.$slots,"default")]),_:3},16,["class"]))}}),De=v({__name:"SheetHeader",props:{class:{}},setup(t){const e=t;return(d,m)=>(l(),r("div",{"data-slot":"sheet-header",class:J(i($)("flex flex-col gap-1.5 p-4",e.class))},[w(d.$slots,"default")],2))}}),ke=v({__name:"SheetTitle",props:{asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,d=C(e,"class");return(m,y)=>(l(),h(i(ge),B({"data-slot":"sheet-title",class:i($)("text-foreground font-semibold",e.class)},i(d)),{default:o(()=>[w(m.$slots,"default")]),_:3},16,["class"]))}}),Me=v({__name:"SheetTrigger",props:{asChild:{type:Boolean},as:{}},setup(t){const e=t;return(d,m)=>(l(),h(i(he),B({"data-slot":"sheet-trigger"},e),{default:o(()=>[w(d.$slots,"default")]),_:3},16))}}),Ce={components:{Popover:te,PopoverContent:se,PopoverTrigger:ee,DropdownMenu:pe,DropdownMenuContent:ue,DropdownMenuItem:de,DropdownMenuLabel:ie,DropdownMenuSeparator:re,DropdownMenuTrigger:le,Sheet:we,SheetContent:Se,SheetDescription:$e,SheetHeader:De,SheetTitle:ke,SheetTrigger:Me},data:()=>({bidService:new R,loading:!0,bids:[],search:{text:"",used:!1,result:""},currentBid:null,drawerOpen:!1,drawerLoading:!0,profession:oe,getRoute:ae,getStatus:ve,getStatusList:ye}),async created(){await this.getAll()},computed:{methodStore(){return Z()},bidsMap(){return this.search.used?this.search.result:this.bids}},methods:{getProfession(t){return this.profession(t).getProfessionByValue.map(e=>e.name).join(", ")},async getAll(){this.bids=await this.bidService.getAll(),this.loading=!1},async updateBidStatusById(t,e){var d;await this.bidService.updateStatusById(t,e),await this.getAll(),t===((d=this.currentBid)==null?void 0:d.id)&&await this.openBid(t)},async openBid(t){this.drawerOpen=!0,this.drawerLoading=!0,this.currentBid=await this.bidService.getById(t),this.drawerLoading=!1},async onSearch(){if(this.search.text.trim().length===0){this.search.result=[],this.search.used=!1;return}this.search.result=await this.bidService.getBySearch(this.search.text),this.search.used=!0}}},xe={class:"flex justify-between"},Pe={class:"input border"},Ie={key:0,class:"flex justify-center"},Te={key:1,role:"alert",class:"alert"},je={key:2,class:"overflow-x-auto"},Le={class:"table table-sm"},Oe={class:"text-xs opacity-55"},Ye={class:"whitespace-nowrap text-primary cursor-pointer"},ze={class:"grid gap-4"},He={class:"space-y-2"},Ae={class:"text-sm font-medium leading-none"},Ee={class:"grid gap-2"},Fe={class:"grid grid-cols-3 items-center gap-4 text-xs"},Ve={class:"col-span-2"},Ne={class:"col-span-2 text-primary"},qe=["href"],Ue={class:"col-span-2"},Ge={class:"whitespace-nowrap text-primary cursor-pointer"},Je={class:"grid gap-4"},Ke={class:"space-y-2"},Re={class:"text-sm font-medium leading-none"},Xe={class:"grid gap-2"},Qe=["src"],We={class:"grid grid-cols-3 items-center gap-4 text-sm"},Ze={class:"col-span-2"},es={class:"col-span-2"},ss={class:"whitespace-nowrap flex items-center gap-2"},ts=["onClick"],ns={key:0,class:"flex items-center justify-center flex-1"},as={class:"px-4 pb-4 flex flex-col gap-4 w-full"},os={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},ls=["value"],rs=["value"],is={class:"relative"},ds=["value"],us={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},ps=["value"],cs=["value"],ms=["value"],fs=["value"],_s={key:0,class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},bs={class:"label"},gs=["value"],hs=["value"],ys={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},vs=["src"],ws=["value"],Bs=["value"],Ss=["value"];function $s(t,e,d,m,y,c){const f=u("Icon"),D=u("Info"),x=u("PopoverTrigger"),P=u("PopoverContent"),I=u("Popover"),T=u("DropdownMenuTrigger"),j=u("DropdownMenuLabel"),L=u("DropdownMenuSeparator"),O=u("DropdownMenuItem"),Y=u("DropdownMenuContent"),z=u("DropdownMenu"),E=u("SheetTitle"),F=u("SheetDescription"),V=u("SheetHeader"),H=u("router-link"),N=u("SheetContent"),q=u("Sheet");return l(),r(g,null,[s("div",xe,[e[4]||(e[4]=s("h1",{class:"text-2xl font-semibold mb-10"},"Все заявки",-1)),s("form",{onSubmit:e[1]||(e[1]=X((...n)=>c.onSearch&&c.onSearch(...n),["prevent"])),class:"flex gap-2"},[s("label",Pe,[a(f,{name:"Search",size:16}),Q(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.search.text=n),type:"text",class:"grow",placeholder:"id, email, username"},null,512),[[W,t.search.text]])]),e[3]||(e[3]=s("button",{class:"btn"},"Поиск",-1))],32)]),t.loading?(l(),r("div",Ie,e[5]||(e[5]=[s("span",{class:"loading loading-spinner text-primary"},null,-1)]))):b("",!0),!t.loading&&c.bidsMap.length===0?(l(),r("div",Te,[a(D,{class:"min-size-4 text-primary"}),e[6]||(e[6]=s("span",null,"На данный момент нет заявок. Вернитесь позже",-1))])):b("",!0),!t.loading&&c.bidsMap.length>0?(l(),r("div",je,[s("table",Le,[e[18]||(e[18]=s("thead",null,[s("tr",null,[s("th",{class:"font-medium"},"Создано"),s("th",{class:"font-medium"},"Клиент"),s("th",{class:"font-medium"},"Специалист"),s("th",{class:"font-medium"},"Желаемая дата"),s("th",{class:"font-medium"},"Статус"),s("th",{class:"font-medium"},"Детали заявки")])],-1)),s("tbody",null,[(l(!0),r(g,null,M(c.bidsMap,(n,S)=>(l(),r("tr",{key:S},[s("td",null,[_(p(t.$dayjs(n.created_at).format("DD-MM-YYYY HH:mm:ss"))+" ",1),e[7]||(e[7]=s("br",null,null,-1)),s("span",Oe,p(n.id),1)]),s("td",null,[a(I,null,{default:o(()=>[a(x,{"as-child":""},{default:o(()=>[s("span",Ye,p(n.customer.first_name),1)]),_:2},1024),a(P,{class:"w-80"},{default:o(()=>[s("div",ze,[s("div",He,[s("h4",Ae," ID: "+p(n.customer.id),1),e[8]||(e[8]=s("p",{class:"text-sm text-muted-foreground"}," Информация о клиенте ",-1))]),s("div",Ee,[s("div",Fe,[e[10]||(e[10]=s("span",null,"Email",-1)),s("span",Ve,p(n.customer.email),1),n.customer.username?(l(),r(g,{key:0},[e[9]||(e[9]=s("span",null,"Username",-1)),s("span",Ne,[s("a",{href:`https://t.me/${n.customer.username}`}," @"+p(n.customer.username),9,qe)])],64)):b("",!0),e[11]||(e[11]=s("span",null,"Chat ID",-1)),s("span",Ue,p(n.customer.chat_id),1)])]),e[12]||(e[12]=s("button",{class:"btn w-full btn-primary"}," Отправить сообщение ",-1))])]),_:2},1024)]),_:2},1024)]),s("td",null,[a(I,null,{default:o(()=>[a(x,{"as-child":""},{default:o(()=>[s("span",Ge,p(n.specialist.first_name),1)]),_:2},1024),a(P,{class:"w-80"},{default:o(()=>[s("div",Je,[s("div",Ke,[s("h4",Re," ID: "+p(n.specialist.id),1),e[13]||(e[13]=s("p",{class:"text-sm text-muted-foreground"}," Информация о специалисте ",-1))]),s("div",Xe,[n.specialist.photo?(l(),r("img",{key:0,src:t.$file(n.specialist.photo),alt:"",class:"w-[90px] h-[90px] rounded-lg mb-2 object-cover"},null,8,Qe)):b("",!0),s("div",We,[e[14]||(e[14]=s("span",null,"Профессия",-1)),s("span",Ze,p(c.getProfession(n.specialist.profession)),1),e[15]||(e[15]=s("span",null,"Цена",-1)),s("span",es,p(t.$currency(n.specialist.price)),1)])]),e[16]||(e[16]=s("button",{class:"btn w-full btn-primary"}," Открыть профиль ",-1))])]),_:2},1024)]),_:2},1024)]),s("td",null,p(n.date),1),s("td",null,[a(z,null,{default:o(()=>[a(T,null,{default:o(()=>[s("span",ss,[_(p(t.getStatus(n.status))+" ",1),a(f,{name:"ChevronDown",size:14})])]),_:2},1024),a(Y,null,{default:o(()=>[a(j,{class:"text-sm"},{default:o(()=>e[17]||(e[17]=[_(" Изменить статус ")])),_:1,__:[17]}),a(L),(l(!0),r(g,null,M(t.getStatusList,(k,U)=>(l(),h(O,{key:U,class:"hover:bg-gray-100",onClick:Ds=>c.updateBidStatusById(n.id,k.value)},{default:o(()=>[_(p(k.name),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),s("td",null,[s("button",{class:"btn btn-sm w-full",onClick:k=>c.openBid(n.id)}," Открыть ",8,ts)])]))),128))])])])):b("",!0),a(q,{open:t.drawerOpen,"onUpdate:open":e[2]||(e[2]=n=>t.drawerOpen=n)},{default:o(()=>[a(N,{class:"overflow-y-scroll flex flex-col"},{default:o(()=>[t.drawerLoading?(l(),r("div",ns,e[19]||(e[19]=[s("span",{class:"loading loading-spinner text-primary"},null,-1)]))):b("",!0),!t.drawerLoading&&t.currentBid!==null?(l(),r(g,{key:1},[a(V,null,{default:o(()=>[a(E,{class:"leading-none"},{default:o(()=>[_(" ID: "+p(t.currentBid.id),1)]),_:1}),a(F,null,{default:o(()=>e[20]||(e[20]=[_("Заявка на сессию")])),_:1,__:[20]})]),_:1}),s("div",as,[s("fieldset",os,[e[22]||(e[22]=s("legend",{class:"fieldset-legend"},"Детали заявки",-1)),e[23]||(e[23]=s("label",{class:"label"},"Создано",-1)),s("input",{class:"input border",value:t.$dayjs(t.currentBid.created_at).format("DD-MM-YYYY HH:mm:ss"),readonly:""},null,8,ls),e[24]||(e[24]=s("label",{class:"label"},"Желаемая дата на сессию (по мск)",-1)),s("input",{class:"input border",value:t.currentBid.date,readonly:""},null,8,rs),e[25]||(e[25]=s("label",{class:"label"},"Статус",-1)),s("div",is,[s("input",{class:"input border",value:t.getStatus(t.currentBid.status),readonly:""},null,8,ds),a(z,null,{default:o(()=>[a(T,{class:"btn btn-sm btn-square absolute top-1/2 right-2",style:{transform:"translateY(-50%) !important"}},{default:o(()=>[a(f,{name:"ChevronDown",size:16})]),_:1}),a(Y,{side:"bottom",align:"end"},{default:o(()=>[a(j,{class:"text-sm"},{default:o(()=>e[21]||(e[21]=[_(" Изменить статус ")])),_:1,__:[21]}),a(L),(l(!0),r(g,null,M(t.getStatusList,(n,S)=>(l(),h(O,{key:S,class:"hover:bg-gray-100",onClick:k=>c.updateBidStatusById(t.currentBid.id,n.value)},{default:o(()=>[_(p(n.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),e[26]||(e[26]=s("button",{class:"btn btn-accent"},"Выставить счет на оплату",-1))]),s("fieldset",us,[e[28]||(e[28]=s("legend",{class:"fieldset-legend"},"Клиент",-1)),e[29]||(e[29]=s("label",{class:"label"},"Имя",-1)),s("input",{class:"input border",value:t.currentBid.customer.first_name,readonly:""},null,8,ps),e[30]||(e[30]=s("label",{class:"label"},"Фамилия",-1)),s("input",{class:"input border",value:t.currentBid.customer.last_name,readonly:""},null,8,cs),e[31]||(e[31]=s("label",{class:"label"},"Email",-1)),s("input",{class:"input border",value:t.currentBid.customer.email},null,8,ms),e[32]||(e[32]=s("label",{class:"label"},"Telegram username",-1)),s("input",{class:"input border",value:t.currentBid.customer.username},null,8,fs),a(H,{to:`/admin/dashboard/chats?customer=${t.currentBid.customer.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[27]||(e[27]=[_(" Написать сообщение ")])),_:1,__:[27]},8,["to"])]),t.currentBid.body.length>0?(l(),r("fieldset",_s,[e[33]||(e[33]=s("legend",{class:"fieldset-legend"},"Опрос",-1)),(l(!0),r(g,null,M(t.currentBid.body,(n,S)=>(l(),r(g,{key:S},[s("label",bs,p(n.question),1),n.answer.length<=2?(l(),r("input",{key:0,class:"input border",value:n.answer.join(", "),readonly:""},null,8,gs)):(l(),r("textarea",{key:1,class:"textarea w-full",value:n.answer.join(`
`),placeholder:"Bio"},null,8,hs))],64))),128))])):b("",!0),s("fieldset",ys,[e[35]||(e[35]=s("legend",{class:"fieldset-legend"},"Специалист",-1)),t.currentBid.specialist.photo?(l(),r("img",{key:0,src:t.$file(t.currentBid.specialist.photo),alt:"",class:"w-[100px] h-[100px] object-cover rounded-lg mb-2"},null,8,vs)):b("",!0),e[36]||(e[36]=s("label",{class:"label"},"Имя",-1)),s("input",{class:"input border",value:t.currentBid.specialist.first_name,readonly:""},null,8,ws),e[37]||(e[37]=s("label",{class:"label"},"Цена",-1)),s("input",{class:"input border",value:t.$currency(t.currentBid.specialist.price)},null,8,Bs),e[38]||(e[38]=s("label",{class:"label"},"Сессии было",-1)),s("input",{class:"input border",value:t.currentBid.specialist.sessions},null,8,Ss),a(H,{to:`/admin/dashboard/specialists/${t.currentBid.specialist.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[34]||(e[34]=[_(" Открыть ")])),_:1,__:[34]},8,["to"])])])],64)):b("",!0)]),_:1})]),_:1},8,["open"])],64)}const Is=K(Ce,[["render",$s]]);export{Is as default};
