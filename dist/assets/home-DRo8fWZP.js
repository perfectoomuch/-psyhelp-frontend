import{a as v,f as h,o as l,w as o,G as B,E as i,D as w,b as n,e as s,X as U,c as r,n as G,_ as J,ai as K,g as b,J as R,j as X,r as p,l as Q,F as g,i as M,q as _,t as d,ah as W}from"./index-Do8ladI-.js";import{_ as Z,a as ee,b as se}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CQlIJ_7r.js";import{_ as te,g as ae,p as ne}from"./DialogPortal-ZPs-Fjke.js";import{_ as oe,a as le,b as re,c as ie,d as de,e as ue}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DjRwKgLP.js";import{a as H,_ as pe,r as C,e as ce,b as D,f as me,g as fe,h as _e,j as be,k as ge}from"./utils-DopF4P6a.js";const he=[{value:"in_agreement",name:"В согласовании"},{value:"cancelled",name:"Отменено"},{value:"confirmed",name:"Подтверждено"}],ye=t=>{switch(t){case"in_agreement":return"В согласовании";case"cancelled":return"Отменено";case"confirmed":return"Подтверждено"}},ve=v({__name:"Sheet",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(t,{emit:e}){const y=H(t,e);return(c,m)=>(l(),h(i(pe),B({"data-slot":"sheet"},i(y)),{default:o(()=>[w(c.$slots,"default")]),_:3},16))}}),we=v({__name:"SheetOverlay",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,u=C(e,"class");return(f,y)=>(l(),h(i(ce),B({"data-slot":"sheet-overlay",class:i(D)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",e.class)},i(u)),{default:o(()=>[w(f.$slots,"default")]),_:3},16,["class"]))}}),Be=v({inheritAttrs:!1,__name:"SheetContent",props:{class:{},side:{default:"right"},forceMount:{type:Boolean},trapFocus:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(t,{emit:e}){const u=t,f=e,y=C(u,"class","side"),c=H(y,f);return(m,S)=>(l(),h(i(te),null,{default:o(()=>[n(we),n(i(fe),B({"data-slot":"sheet-content",class:i(D)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",m.side==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",m.side==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",m.side==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",m.side==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",u.class)},{...i(c),...m.$attrs}),{default:o(()=>[w(m.$slots,"default"),n(i(me),{class:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none"},{default:o(()=>[n(i(U),{class:"size-4"}),S[0]||(S[0]=s("span",{class:"sr-only"},"Close",-1))]),_:1,__:[0]})]),_:3},16,["class"])]),_:3}))}}),Se=v({__name:"SheetDescription",props:{asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,u=C(e,"class");return(f,y)=>(l(),h(i(_e),B({"data-slot":"sheet-description",class:i(D)("text-muted-foreground text-sm",e.class)},i(u)),{default:o(()=>[w(f.$slots,"default")]),_:3},16,["class"]))}}),$e=v({__name:"SheetHeader",props:{class:{}},setup(t){const e=t;return(u,f)=>(l(),r("div",{"data-slot":"sheet-header",class:G(i(D)("flex flex-col gap-1.5 p-4",e.class))},[w(u.$slots,"default")],2))}}),De=v({__name:"SheetTitle",props:{asChild:{type:Boolean},as:{},class:{}},setup(t){const e=t,u=C(e,"class");return(f,y)=>(l(),h(i(be),B({"data-slot":"sheet-title",class:i(D)("text-foreground font-semibold",e.class)},i(u)),{default:o(()=>[w(f.$slots,"default")]),_:3},16,["class"]))}}),ke=v({__name:"SheetTrigger",props:{asChild:{type:Boolean},as:{}},setup(t){const e=t;return(u,f)=>(l(),h(i(ge),B({"data-slot":"sheet-trigger"},e),{default:o(()=>[w(u.$slots,"default")]),_:3},16))}}),Me={components:{Popover:se,PopoverContent:ee,PopoverTrigger:Z,DropdownMenu:ue,DropdownMenuContent:de,DropdownMenuItem:ie,DropdownMenuLabel:re,DropdownMenuSeparator:le,DropdownMenuTrigger:oe,Sheet:ve,SheetContent:Be,SheetDescription:Se,SheetHeader:$e,SheetTitle:De,SheetTrigger:ke},data:()=>({bidService:new K,loading:!0,bids:[],search:{text:"",used:!1,result:""},currentBid:null,drawerOpen:!1,drawerLoading:!0,profession:ne,getRoute:ae,getStatus:ye,getStatusList:he}),async created(){await this.getAll()},computed:{methodStore(){return W()},bidsMap(){return this.search.used?this.search.result:this.bids}},methods:{getProfession(t){return this.profession(t).getProfessionByValue.map(e=>e.name).join(", ")},async getAll(){this.bids=await this.bidService.getAll(),this.loading=!1},async updateBidStatusById(t,e){var u;await this.bidService.updateStatusById(t,e),await this.getAll(),t===((u=this.currentBid)==null?void 0:u.id)&&await this.openBid(t)},async openBid(t){this.drawerOpen=!0,this.drawerLoading=!0,this.currentBid=await this.bidService.getById(t),this.drawerLoading=!1},async onSearch(){if(this.search.text.trim().length===0){this.search.result=[],this.search.used=!1;return}this.search.result=await this.bidService.getBySearch(this.search.text),this.search.used=!0}}},Ce={class:"flex justify-between"},xe={class:"input border"},Pe={key:0,class:"flex justify-center"},Ie={key:1,role:"alert",class:"alert"},Te={key:2,class:"overflow-x-auto"},je={class:"table table-sm"},Le={class:"text-xs opacity-55"},Oe={class:"whitespace-nowrap text-primary cursor-pointer"},Ye={class:"grid gap-4"},ze={class:"space-y-2"},He={class:"text-sm font-medium leading-none"},Ae={class:"grid gap-2"},Ee={class:"grid grid-cols-3 items-center gap-4 text-xs"},Fe={class:"col-span-2"},Ve={class:"col-span-2 text-primary"},Ne=["href"],qe={class:"col-span-2"},Ue={class:"whitespace-nowrap text-primary cursor-pointer"},Ge={class:"grid gap-4"},Je={class:"space-y-2"},Ke={class:"text-sm font-medium leading-none"},Re={class:"grid gap-2"},Xe=["src"],Qe={class:"grid grid-cols-3 items-center gap-4 text-sm"},We={class:"col-span-2"},Ze={class:"col-span-2"},es={class:"whitespace-nowrap flex items-center gap-2"},ss=["onClick"],ts={key:0,class:"flex items-center justify-center flex-1"},as={class:"px-4 pb-4 flex flex-col gap-4 w-full"},ns={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},os=["value"],ls=["value"],rs={class:"relative"},is=["value"],ds={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},us=["value"],ps=["value"],cs=["value"],ms=["value"],fs={key:0,class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},_s={class:"label"},bs=["value"],gs=["value"],hs={class:"fieldset bg-base-200 border-base-300 rounded-box border p-4"},ys=["src"],vs=["value"],ws=["value"],Bs=["value"];function Ss(t,e,u,f,y,c){const m=p("Icon"),S=p("PopoverTrigger"),P=p("PopoverContent"),I=p("Popover"),x=p("router-link"),T=p("DropdownMenuTrigger"),j=p("DropdownMenuLabel"),L=p("DropdownMenuSeparator"),O=p("DropdownMenuItem"),Y=p("DropdownMenuContent"),z=p("DropdownMenu"),A=p("SheetTitle"),E=p("SheetDescription"),F=p("SheetHeader"),V=p("SheetContent"),N=p("Sheet");return l(),r(g,null,[s("div",Ce,[e[4]||(e[4]=s("h1",{class:"text-2xl font-semibold mb-10"},"Все заявки",-1)),s("form",{onSubmit:e[1]||(e[1]=R((...a)=>c.onSearch&&c.onSearch(...a),["prevent"])),class:"flex gap-2"},[s("label",xe,[n(m,{name:"Search",size:16}),X(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.search.text=a),type:"text",class:"grow",placeholder:"id, email, username"},null,512),[[Q,t.search.text]])]),e[3]||(e[3]=s("button",{class:"btn"},"Поиск",-1))],32)]),t.loading?(l(),r("div",Pe,e[5]||(e[5]=[s("span",{class:"loading loading-spinner text-primary"},null,-1)]))):b("",!0),!t.loading&&c.bidsMap.length===0?(l(),r("div",Ie,[n(m,{name:"Info",class:"min-size-4 text-primary"}),e[6]||(e[6]=s("span",null,"На данный момент нет заявок. Вернитесь позже",-1))])):b("",!0),!t.loading&&c.bidsMap.length>0?(l(),r("div",Te,[s("table",je,[e[18]||(e[18]=s("thead",null,[s("tr",null,[s("th",{class:"font-medium"},"Создано"),s("th",{class:"font-medium"},"Клиент"),s("th",{class:"font-medium"},"Специалист"),s("th",{class:"font-medium"},"Желаемая дата"),s("th",{class:"font-medium"},"Статус"),s("th",{class:"font-medium"},"Детали заявки")])],-1)),s("tbody",null,[(l(!0),r(g,null,M(c.bidsMap,(a,$)=>(l(),r("tr",{key:$},[s("td",null,[_(d(t.$dayjs(a.created_at).format("DD-MM-YYYY HH:mm:ss"))+" ",1),e[7]||(e[7]=s("br",null,null,-1)),s("span",Le,d(a.id),1)]),s("td",null,[n(I,null,{default:o(()=>[n(S,{"as-child":""},{default:o(()=>[s("span",Oe,d(a.customer.first_name),1)]),_:2},1024),n(P,{class:"w-80"},{default:o(()=>[s("div",Ye,[s("div",ze,[s("h4",He," ID: "+d(a.customer.id),1),e[8]||(e[8]=s("p",{class:"text-sm text-muted-foreground"}," Информация о клиенте ",-1))]),s("div",Ae,[s("div",Ee,[e[10]||(e[10]=s("span",null,"Email",-1)),s("span",Fe,d(a.customer.email),1),a.customer.username?(l(),r(g,{key:0},[e[9]||(e[9]=s("span",null,"Username",-1)),s("span",Ve,[s("a",{href:`https://t.me/${a.customer.username}`}," @"+d(a.customer.username),9,Ne)])],64)):b("",!0),e[11]||(e[11]=s("span",null,"Chat ID",-1)),s("span",qe,d(a.customer.chat_id),1)])]),e[12]||(e[12]=s("button",{class:"btn w-full btn-primary"}," Отправить сообщение ",-1))])]),_:2},1024)]),_:2},1024)]),s("td",null,[n(I,null,{default:o(()=>[n(S,{"as-child":""},{default:o(()=>[s("span",Ue,d(a.specialist.first_name)+" "+d(a.specialist.last_name),1)]),_:2},1024),n(P,{class:"w-80"},{default:o(()=>[s("div",Ge,[s("div",Je,[s("h4",Ke," ID: "+d(a.specialist.id),1),e[13]||(e[13]=s("p",{class:"text-sm text-muted-foreground"}," Информация о специалисте ",-1))]),s("div",Re,[a.specialist.photo?(l(),r("img",{key:0,src:t.$file(a.specialist.photo),alt:"",class:"w-[90px] h-[90px] rounded-lg mb-2 object-cover"},null,8,Xe)):b("",!0),s("div",Qe,[e[14]||(e[14]=s("span",null,"Профессия",-1)),s("span",We,d(c.getProfession(a.specialist.profession)),1),e[15]||(e[15]=s("span",null,"Цена",-1)),s("span",Ze,d(t.$currency(a.specialist.price)),1)])]),n(x,{to:`/admin/dashboard/specialists/${a.specialist.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[16]||(e[16]=[_(" Открыть профиль ")])),_:2,__:[16]},1032,["to"])])]),_:2},1024)]),_:2},1024)]),s("td",null,d(a.date),1),s("td",null,[n(z,null,{default:o(()=>[n(T,null,{default:o(()=>[s("span",es,[_(d(t.getStatus(a.status))+" ",1),n(m,{name:"ChevronDown",size:14})])]),_:2},1024),n(Y,null,{default:o(()=>[n(j,{class:"text-sm"},{default:o(()=>e[17]||(e[17]=[_(" Изменить статус ")])),_:1,__:[17]}),n(L),(l(!0),r(g,null,M(t.getStatusList,(k,q)=>(l(),h(O,{key:q,class:"hover:bg-gray-100",onClick:$s=>c.updateBidStatusById(a.id,k.value)},{default:o(()=>[_(d(k.name),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),s("td",null,[s("button",{class:"btn btn-sm w-full",onClick:k=>c.openBid(a.id)}," Открыть ",8,ss)])]))),128))])])])):b("",!0),n(N,{open:t.drawerOpen,"onUpdate:open":e[2]||(e[2]=a=>t.drawerOpen=a)},{default:o(()=>[n(V,{class:"overflow-y-scroll flex flex-col"},{default:o(()=>[t.drawerLoading?(l(),r("div",ts,e[19]||(e[19]=[s("span",{class:"loading loading-spinner text-primary"},null,-1)]))):b("",!0),!t.drawerLoading&&t.currentBid!==null?(l(),r(g,{key:1},[n(F,null,{default:o(()=>[n(A,{class:"leading-none"},{default:o(()=>[_(" ID: "+d(t.currentBid.id),1)]),_:1}),n(E,null,{default:o(()=>e[20]||(e[20]=[_("Заявка на сессию")])),_:1,__:[20]})]),_:1}),s("div",as,[s("fieldset",ns,[e[22]||(e[22]=s("legend",{class:"fieldset-legend"},"Детали заявки",-1)),e[23]||(e[23]=s("label",{class:"label"},"Создано",-1)),s("input",{class:"input border",value:t.$dayjs(t.currentBid.created_at).format("DD-MM-YYYY HH:mm:ss"),readonly:""},null,8,os),e[24]||(e[24]=s("label",{class:"label"},"Желаемая дата на сессию (по мск)",-1)),s("input",{class:"input border",value:t.currentBid.date,readonly:""},null,8,ls),e[25]||(e[25]=s("label",{class:"label"},"Статус",-1)),s("div",rs,[s("input",{class:"input border",value:t.getStatus(t.currentBid.status),readonly:""},null,8,is),n(z,null,{default:o(()=>[n(T,{class:"btn btn-sm btn-square absolute top-1/2 right-2",style:{transform:"translateY(-50%) !important"}},{default:o(()=>[n(m,{name:"ChevronDown",size:16})]),_:1}),n(Y,{side:"bottom",align:"end"},{default:o(()=>[n(j,{class:"text-sm"},{default:o(()=>e[21]||(e[21]=[_(" Изменить статус ")])),_:1,__:[21]}),n(L),(l(!0),r(g,null,M(t.getStatusList,(a,$)=>(l(),h(O,{key:$,class:"hover:bg-gray-100",onClick:k=>c.updateBidStatusById(t.currentBid.id,a.value)},{default:o(()=>[_(d(a.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),e[26]||(e[26]=s("button",{class:"btn btn-accent"},"Выставить счет на оплату",-1))]),s("fieldset",ds,[e[28]||(e[28]=s("legend",{class:"fieldset-legend"},"Клиент",-1)),e[29]||(e[29]=s("label",{class:"label"},"Имя",-1)),s("input",{class:"input border",value:t.currentBid.customer.first_name,readonly:""},null,8,us),e[30]||(e[30]=s("label",{class:"label"},"Фамилия",-1)),s("input",{class:"input border",value:t.currentBid.customer.last_name,readonly:""},null,8,ps),e[31]||(e[31]=s("label",{class:"label"},"Email",-1)),s("input",{class:"input border",value:t.currentBid.customer.email},null,8,cs),e[32]||(e[32]=s("label",{class:"label"},"Telegram username",-1)),s("input",{class:"input border",value:t.currentBid.customer.username},null,8,ms),n(x,{to:`/admin/dashboard/chats?customer=${t.currentBid.customer.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[27]||(e[27]=[_(" Написать сообщение ")])),_:1,__:[27]},8,["to"])]),t.currentBid.body.length>0?(l(),r("fieldset",fs,[e[33]||(e[33]=s("legend",{class:"fieldset-legend"},"Опрос",-1)),(l(!0),r(g,null,M(t.currentBid.body,(a,$)=>(l(),r(g,{key:$},[s("label",_s,d(a.question),1),a.answer.length<=2?(l(),r("input",{key:0,class:"input border",value:a.answer.join(", "),readonly:""},null,8,bs)):(l(),r("textarea",{key:1,class:"textarea w-full",value:a.answer.join(`
`),placeholder:"Bio"},null,8,gs))],64))),128))])):b("",!0),s("fieldset",hs,[e[35]||(e[35]=s("legend",{class:"fieldset-legend"},"Специалист",-1)),t.currentBid.specialist.photo?(l(),r("img",{key:0,src:t.$file(t.currentBid.specialist.photo),alt:"",class:"w-[100px] h-[100px] object-cover rounded-lg mb-2"},null,8,ys)):b("",!0),e[36]||(e[36]=s("label",{class:"label"},"Имя",-1)),s("input",{class:"input border",value:`${t.currentBid.specialist.first_name} ${t.currentBid.specialist.last_name}`,readonly:""},null,8,vs),e[37]||(e[37]=s("label",{class:"label"},"Цена",-1)),s("input",{class:"input border",value:t.$currency(t.currentBid.specialist.price)},null,8,ws),e[38]||(e[38]=s("label",{class:"label"},"Сессии было",-1)),s("input",{class:"input border",value:t.currentBid.specialist.sessions},null,8,Bs),n(x,{to:`/admin/dashboard/specialists/${t.currentBid.specialist.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[34]||(e[34]=[_(" Открыть ")])),_:1,__:[34]},8,["to"])])])],64)):b("",!0)]),_:1})]),_:1},8,["open"])],64)}const Ps=J(Me,[["render",Ss]]);export{Ps as default};
