import{_ as B,a as I,b as M,c as N,d as U,e as q,f as F}from"./DialogTrigger.vue_vue_type_script_setup_true_lang.DgG1nC5z.js";import{_ as H,f as h,o as n,w as i,b as r,e as o,r as a,g as _,q as g,t as d,j as m,c,l as f,ak as v,i as j,F as z,J as A}from"./index.CY1TeMWG.js";import{_ as E,a as J,b as L}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang.DoyR2h-P.js";import{T as G,v as K}from"./transaction.service.LBUcJe1W.js";import{S as O}from"./specialist.service.DZ9MwJva.js";const Q={components:{Dialog:F,DialogContent:q,DialogDescription:U,DialogFooter:N,DialogHeader:M,DialogTitle:I,DialogTrigger:B,Popover:L,PopoverContent:J,PopoverTrigger:E},directives:{debounce:K({lock:!0})},data:()=>({specialistService:new O,transactionService:new G,open:!1,popover:!1,form:{specialist_id:"",customer_id:"",total:"",message:""},customer:null,specialist:null,loading:!1,specialists:[],search:{text:"",used:!1,result:[]}}),computed:{specialistsMap(){return this.search.used?this.search.result:this.specialists},getSelectedSpecialist(){return this.specialist?this.specialist.first_name+" "+this.specialist.last_name:""}},methods:{openAction(s,e){if(e){const{customer:p,specialist:u}=e;p&&(this.customer=p,this.form.customer_id=this.customer.id),u&&(this.specialist=u,this.form.specialist_id=this.specialist.id,this.form.total=this.specialist.price)}this.open=s},async onSearch(){if(this.search.text.trim().length===0){this.search.result=[],this.search.used=!1;return}this.loading=!0,this.search.result=await this.specialistService.getBySearch(this.search.text),this.search.used=!0,this.loading=!1},async onSubmit(){const s={...this.form,total:Number(parseInt(this.form.total))},e=await this.transactionService.create(s);(e==null?void 0:e.message)==="success"&&(this.$toast.success("Выставлен счет на оплату"),this.$emit("update"),this.reset())},reset(){this.popover=!1,this.open=!1,this.form={specialist_id:"",customer_id:"",total:"",message:""},this.customer=null,this.specialist=null,this.search={text:"",used:!1,result:[]},this.specialists=[]},onChangeSpecialist(s){this.specialist=s,this.form.specialist_id=this.specialist.id,this.form.total=this.specialist.price,this.popover=!1}}},R={class:"flex flex-col gap-1"},W=["value"],X={class:"relative"},Y={key:0,class:"absolute right-3 top-2 z-1 flex items-center"},Z={class:"flex flex-col text-sm"},ee=["src"],se=["onClick"],te={key:1,class:"h-4"},oe={class:"flex flex-col gap-1"},ae={class:"flex flex-col gap-1"};function ie(s,e,p,u,le,l){const b=a("DialogTitle"),D=a("DialogDescription"),w=a("DialogHeader"),S=a("PopoverTrigger"),x=a("Icon"),k=a("PopoverContent"),y=a("Popover"),C=a("DialogContent"),T=a("Dialog"),$=v("debounce"),P=v("maska");return n(),h(T,{open:s.open,"onUpdate:open":e[5]||(e[5]=t=>s.open=t)},{default:i(()=>[r(C,{class:"w-sm"},{default:i(()=>[r(w,null,{default:i(()=>[r(b,null,{default:i(()=>e[6]||(e[6]=[g("Выставить счет")])),_:1,__:[6]}),s.customer?(n(),h(D,{key:0},{default:i(()=>[g(" Клиент: "+d(s.customer.username),1)]),_:1})):_("",!0)]),_:1}),o("form",{onSubmit:e[4]||(e[4]=A((...t)=>l.onSubmit&&l.onSubmit(...t),["prevent"])),class:"flex flex-col gap-4"},[o("div",R,[e[8]||(e[8]=o("label",{class:"label"},"Специалист",-1)),r(y,{open:s.popover,"onUpdate:open":e[1]||(e[1]=t=>s.popover=t)},{default:i(()=>[r(S,{class:"w-full"},{default:i(()=>[o("input",{class:"input border w-full",value:l.getSelectedSpecialist,required:"",readonly:""},null,8,W)]),_:1}),r(k,{class:"w-[var(--reka-popper-anchor-width)] overflow-y-auto max-h-[400px]"},{default:i(()=>[o("div",X,[m(o("input",{class:"input input-sm border w-full mb-4 pr-10","onUpdate:modelValue":e[0]||(e[0]=t=>s.search.text=t),placeholder:"Поиск специалиста"},null,512),[[f,s.search.text],[$,l.onSearch,"500ms"]]),s.loading?(n(),c("div",Y,e[7]||(e[7]=[o("span",{class:"loading loading-spinner text-primary w-4"},null,-1)]))):_("",!0)]),o("div",Z,[l.specialistsMap.length>0?(n(!0),c(z,{key:0},j(l.specialistsMap,(t,V)=>(n(),c("div",{class:"flex items-center gap-2 py-1",key:V},[o("img",{class:"w-full h-auto object-cover max-w-10 max-h-10 rounded-full border",src:s.$file(t.photo)},null,8,ee),o("span",null,d(t==null?void 0:t.first_name)+" "+d(t==null?void 0:t.last_name),1),o("button",{class:"btn btn-sm btn-circle ml-auto",onClick:re=>l.onChangeSpecialist(t)},[r(x,{name:"Plus",class:"w-4 h-4"})],8,se)]))),128)):(n(),c("div",te,"Нет данных."))])]),_:1})]),_:1},8,["open"])]),o("div",oe,[e[9]||(e[9]=o("label",{class:"label"},"Итоговая сумма",-1)),m(o("input",{class:"input border w-full","onUpdate:modelValue":e[2]||(e[2]=t=>s.form.total=t),required:""},null,512),[[f,s.form.total],[P,"###########"]])]),o("div",ae,[e[10]||(e[10]=o("label",{class:"label"},"Текст сообщении",-1)),m(o("textarea",{class:"textarea w-full border w-full","onUpdate:modelValue":e[3]||(e[3]=t=>s.form.message=t),placeholder:"Сообщение"},null,512),[[f,s.form.message]])]),e[11]||(e[11]=o("button",{class:"btn btn-primary"},"Выставить счет",-1))],32)]),_:1})]),_:1},8,["open"])}const me=H(Q,[["render",ie]]);export{me as I};
