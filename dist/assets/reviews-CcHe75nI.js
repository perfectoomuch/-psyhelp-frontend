import{_ as x,a as H,b as R,c as E,d as F,e as O,f as J}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CF3HXNgN.js";import{S as G,_ as X,a as Z,b as ee,c as te}from"./VueStarRating.common-CtRaXckU.js";import{h as z,a4 as D,_ as K,c as p,o as l,e as a,b as s,F as f,i as U,q as d,t as m,r as i,w as o,g as _,f as $,J as ae,j as N,l as q,ak as se}from"./index-BeL3-aS9.js";import{p as ne}from"./specialist-B1-3R11H.js";import{_ as oe,a as ie,b as le}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-CH8885Tq.js";import{_ as re,a as de,b as pe,c as ue,d as me,e as ge}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DIJVFWeM.js";import{M as fe}from"./MaterializeDatepicker-BRVX2R88.js";import{_ as ce,a as ve,b as _e,c as we,d as be,e as ye}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-D6lPmlUH.js";import"./utils-SVaxs_O8.js";import"./useTypeahead-D2N8t_hs.js";import"./index-BwWeqr07.js";class Q{async getAll(e,r){try{return(await z.post("admin/reviews",e,{params:r})).data}catch(u){console.log(u),D.error("Ошибка при получении")}}async updateById(e,r){try{const u=await z.post(`admin/reviews/${e}`,r);return D.success("Отзыв обновлен"),!0}catch(u){return console.log(u),D.error("Ошибка при сохранении"),!1}}async deleteById(e){try{const r=await z.post(`admin/reviews/delete/${e}`);return D.success("Отзыв удален"),!0}catch(r){return console.log(r),D.error("Ошибка при удалении"),!1}}}const he=t=>{const e={moderation:"На модерации",approved:"Опубликовано",failed:"Провален"},r=Object.entries(e).map(c=>({value:c[0],name:c[1]}));let u=null;return Array.isArray(t)||(u=r.find(c=>c.value===t)),Array.isArray(t)&&(u=r.filter(c=>t.includes(c.value))),{obj:e,list:r,getStatusByValue:u}},De={props:["data"],components:{StarRating:G,Popover:le,PopoverContent:ie,PopoverTrigger:oe,DropdownMenu:ge,DropdownMenuContent:me,DropdownMenuItem:ue,DropdownMenuLabel:pe,DropdownMenuSeparator:de,DropdownMenuTrigger:re,Dialog:J,DialogContent:O,DialogDescription:F,DialogFooter:E,DialogHeader:R,DialogTitle:H,DialogTrigger:x,MaterializeDatepicker:fe},data:()=>({reviewService:new Q,status:he,profession:ne,dialog:!1,review:null,reviewSaving:!1,time:""}),computed:{statusList(){return this.status().list}},methods:{getProfession(t){return this.profession(t).getProfessionByValue.map(e=>e.name).join(", ")},onOpen(t){this.review=t,this.dialog=!0;const e=this.$dayjs(this.review.date).format("YYYY-MM-DD HH:mm").split(" "),r=e[0],u=e[1];this.review.date=this.$dayjs(r).toDate(),this.time=u},setReviewStatus(t,e){this.review.status=e},async updateById(){const t=this.review.id,e=this.$dayjs(this.review.date).format("YYYY-MM-DD"),r=this.time,u=this.$dayjs(`${e} ${r}`).toDate(),c={name:this.review.name,stars:this.review.stars,review:this.review.review,status:this.review.status,date:u};await this.reviewService.updateById(t,c)&&this.$emit("update")},async updateReviewStatus(t,e){const r={status:e};await this.reviewService.updateById(t,r)&&this.$emit("update")},async deleteById(t){await this.reviewService.deleteById(t)&&this.$emit("update")}}},$e={class:"overflow-x-auto"},Pe={class:"table table-sm"},ke={class:"text-xs opacity-55"},Me={class:"whitespace-nowrap text-primary cursor-pointer"},Te={class:"grid gap-4"},Ce={class:"space-y-2"},Se={class:"text-sm font-medium leading-none"},Ie={class:"grid gap-2"},Be=["src"],Ve={class:"grid grid-cols-3 items-center gap-4 text-sm"},Ye={class:"col-span-2"},Ue={class:"col-span-2"},je={class:"whitespace-nowrap flex items-center gap-2"},Ae={class:"flex gap-2"},Le=["onClick"],ze=["onClick"],Ne={class:"flex flex-col gap-2"},qe={class:"flex flex-col gap-2"},xe={class:"flex flex-col gap-2"},He={class:"flex flex-col gap-2"},Re={class:"flex gap-2"},Ee=["value"],Fe={class:"flex flex-col gap-2"},Oe={class:"flex gap-2"},Je=["value"],Ge={class:"flex flex-col gap-2"},Ke=["value"],Qe={class:"flex flex-col gap-2"},We=["disabled"],Xe={key:0,class:"loading loading-sm loading-spinner"};function Ze(t,e,r,u,c,g){const P=i("star-rating"),b=i("PopoverTrigger"),k=i("router-link"),M=i("PopoverContent"),T=i("Popover"),h=i("Icon"),C=i("DropdownMenuTrigger"),S=i("DropdownMenuLabel"),I=i("DropdownMenuSeparator"),B=i("DropdownMenuItem"),V=i("DropdownMenuContent"),w=i("DropdownMenu"),j=i("MaterializeDatepicker"),y=i("DialogContent"),A=i("Dialog"),W=se("maska");return l(),p(f,null,[a("div",$e,[a("table",Pe,[e[14]||(e[14]=a("thead",null,[a("tr",null,[a("th",{class:"font-medium"},"Дата"),a("th",{class:"font-medium"},"Имя"),a("th",{class:"font-medium"},"Рейтинг"),a("th",{class:"font-medium"},"Специалист"),a("th",{class:"font-medium"},"Статус"),a("th",{class:"font-medium"},"Действие")])],-1)),a("tbody",null,[(l(!0),p(f,null,U(r.data,(n,L)=>(l(),p("tr",{key:L},[a("td",null,[d(m(t.$dayjs(n.created_at).format("DD-MM-YYYY HH:mm:ss"))+" ",1),e[7]||(e[7]=a("br",null,null,-1)),a("span",ke,m(n.id),1)]),a("td",null,m(n.name),1),a("td",null,[s(P,{rating:n.stars,"onUpdate:rating":v=>n.stars=v,"star-size":18,"show-rating":!1,"read-only":!0},null,8,["rating","onUpdate:rating"])]),a("td",null,[s(T,null,{default:o(()=>[s(b,{"as-child":""},{default:o(()=>{var v,Y;return[a("span",Me,m((v=n.specialist)==null?void 0:v.first_name)+" "+m((Y=n.specialist)==null?void 0:Y.last_name),1)]}),_:2},1024),s(M,{class:"w-80"},{default:o(()=>[a("div",Te,[a("div",Ce,[a("h4",Se," ID: "+m(n.specialist.id),1),e[8]||(e[8]=a("p",{class:"text-sm text-muted-foreground"}," Информация о специалисте ",-1))]),a("div",Ie,[n.specialist.photo?(l(),p("img",{key:0,src:t.$file(n.specialist.photo),alt:"",class:"w-[90px] h-[90px] rounded-lg mb-2 object-cover"},null,8,Be)):_("",!0),a("div",Ve,[e[9]||(e[9]=a("span",null,"Профессия",-1)),a("span",Ye,m(g.getProfession(n.specialist.profession)),1),e[10]||(e[10]=a("span",null,"Цена",-1)),a("span",Ue,m(t.$currency(n.specialist.price)),1)])]),s(k,{to:`/admin/dashboard/specialists/${n.specialist.id}`,class:"btn w-full btn-primary"},{default:o(()=>e[11]||(e[11]=[d(" Открыть профиль ")])),_:2,__:[11]},1032,["to"])])]),_:2},1024)]),_:2},1024)]),a("td",null,[s(w,null,{default:o(()=>[s(C,null,{default:o(()=>[a("span",je,[d(m(t.status(n.status).getStatusByValue.name)+" ",1),s(h,{name:"ChevronDown",size:14})])]),_:2},1024),s(V,null,{default:o(()=>[s(S,{class:"text-sm"},{default:o(()=>e[12]||(e[12]=[d(" Изменить статус ")])),_:1,__:[12]}),s(I),(l(!0),p(f,null,U(g.statusList,(v,Y)=>(l(),$(B,{key:Y,class:"hover:bg-gray-100",onClick:ot=>g.updateReviewStatus(n.id,v.value)},{default:o(()=>[d(m(v.name),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),a("td",null,[a("div",Ae,[s(T,null,{default:o(()=>[s(b,{class:"btn btn-square btn-sm btn-error btn-soft"},{default:o(()=>[s(h,{name:"Trash",size:16})]),_:1}),s(M,null,{default:o(()=>[e[13]||(e[13]=a("p",{class:"text-sm mb-4"},"Вы точно хотите удалить?",-1)),a("button",{class:"btn btn-sm btn-error w-full",onClick:v=>g.deleteById(n.id)}," Да, удалить ",8,Le)]),_:2,__:[13]},1024)]),_:2},1024),a("button",{class:"btn btn-square btn-sm btn-primary",onClick:v=>g.onOpen(n)},[s(h,{name:"ExternalLink",size:16})],8,ze)])])]))),128))])])]),s(A,{open:t.dialog,"onUpdate:open":e[6]||(e[6]=n=>t.dialog=n)},{default:o(()=>[s(y,{class:"w-sm"},{default:o(()=>[t.review!==null?(l(),p("form",{key:0,onSubmit:e[5]||(e[5]=ae((...n)=>g.updateById&&g.updateById(...n),["prevent"])),class:"flex flex-col gap-4"},[a("div",Ne,[e[15]||(e[15]=a("label",{class:"label"},"Имя",-1)),N(a("input",{class:"input border w-full",placeholder:"Имя пользователя","onUpdate:modelValue":e[0]||(e[0]=n=>t.review.name=n),required:""},null,512),[[q,t.review.name]])]),a("div",qe,[e[16]||(e[16]=a("label",{class:"label"},"Рейтинг",-1)),s(P,{rating:t.review.stars,"onUpdate:rating":e[1]||(e[1]=n=>t.review.stars=n),"star-size":22,"show-rating":!1},null,8,["rating"])]),a("div",xe,[e[17]||(e[17]=a("label",{class:"label"},"Отзыв",-1)),N(a("textarea",{class:"textarea border min-h-[150px] w-full",placeholder:"Текст отзыва","onUpdate:modelValue":e[2]||(e[2]=n=>t.review.review=n),required:""},null,512),[[q,t.review.review]])]),a("div",He,[e[19]||(e[19]=a("label",{class:"label"},"Специалист",-1)),a("div",Re,[a("input",{class:"input border w-full",placeholder:"Ваше имя",value:`${t.review.customer.first_name} ${t.review.customer.last_name}`,disabled:"",readonly:""},null,8,Ee),s(k,{to:`/admin/dashboard/specialists/${t.review.specialist.id}`,class:"btn btn-primary"},{default:o(()=>e[18]||(e[18]=[d(" Открыть ")])),_:1,__:[18]},8,["to"])])]),a("div",Fe,[e[22]||(e[22]=a("label",{class:"label"},"Статус",-1)),a("div",Oe,[a("input",{class:"input border w-full",placeholder:"Ваше имя",value:t.status(t.review.status).getStatusByValue.name,disabled:"",readonly:""},null,8,Je),s(w,null,{default:o(()=>[s(C,{class:"btn btn-primary"},{default:o(()=>e[20]||(e[20]=[d(" Выбрать ")])),_:1,__:[20]}),s(V,null,{default:o(()=>[s(S,{class:"text-sm"},{default:o(()=>e[21]||(e[21]=[d(" Изменить статус ")])),_:1,__:[21]}),s(I),(l(!0),p(f,null,U(g.statusList,(n,L)=>(l(),$(B,{key:L,class:"hover:bg-gray-100",onClick:v=>g.setReviewStatus(t.review.id,n.value)},{default:o(()=>[d(m(n.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})])]),a("div",Ge,[e[23]||(e[23]=a("label",{class:"label"},"Дата",-1)),s(j,{modelValue:t.review.date,"onUpdate:modelValue":e[3]||(e[3]=n=>t.review.date=n),allPeriod:!0},{default:o(()=>[a("input",{class:"input border w-full",placeholder:"Дата отзыва",value:t.$dayjs(t.review.date).format("DD MMM YYYY"),readonly:""},null,8,Ke)]),_:1},8,["modelValue"])]),a("div",Qe,[e[24]||(e[24]=a("label",{class:"label"},"Время",-1)),N(a("input",{class:"input border w-full",placeholder:"Время отзыва","onUpdate:modelValue":e[4]||(e[4]=n=>t.time=n)},null,512),[[q,t.time],[W,"##:##"]])]),a("button",{class:"btn btn-primary w-full btn-soft",type:"submit",disabled:t.reviewSaving},[t.reviewSaving?(l(),p("span",Xe)):(l(),p(f,{key:1},[d(" Сохранить ")],64))],8,We)],32)):_("",!0)]),_:1})]),_:1},8,["open"])],64)}const et=K(De,[["render",Ze]]),tt={components:{Dialog:J,DialogContent:O,DialogDescription:F,DialogFooter:E,DialogHeader:R,DialogTitle:H,DialogTrigger:x,Tabs:te,TabsContent:ee,TabsList:Z,TabsTrigger:X,StarRating:G,Table:et,Pagination:ye,PaginationContent:be,PaginationEllipsis:we,PaginationItem:_e,PaginationNext:ve,PaginationPrevious:ce},data:()=>({reviewService:new Q,loading:!0,reviews:null,filter:{status:"approved"},pagination:{page:1,itemsPerPage:30,total:0}}),created(){this.getAll()},methods:{async getAll(){const t=await this.reviewService.getAll(this.filter,{page:this.pagination.page,limit:this.pagination.itemsPerPage});t&&(this.reviews=t.data,this.pagination.total=t.total,this.loading=!1)},async handleTabChange(){this.loading=!0,this.pagination={page:1,itemsPerPage:30,total:0},await this.getAll()},async handlePageChange(){this.loading=!0,await this.getAll()}}},at={key:0,class:"flex justify-center"},st={key:1,role:"alert",class:"alert"};function nt(t,e,r,u,c,g){const P=i("Icon"),b=i("TabsTrigger"),k=i("TabsList"),M=i("Table"),T=i("PaginationPrevious"),h=i("PaginationItem"),C=i("PaginationEllipsis"),S=i("PaginationNext"),I=i("PaginationContent"),B=i("Pagination"),V=i("Tabs");return l(),p(f,null,[e[7]||(e[7]=a("div",{class:"flex items-center gap-2 mb-10"},[a("h1",{class:"text-2xl font-semibold"},"Отзывы")],-1)),t.loading?(l(),p("div",at,e[2]||(e[2]=[a("span",{class:"loading loading-spinner text-primary"},null,-1)]))):_("",!0),!t.loading&&t.reviews===null?(l(),p("div",st,[s(P,{name:"Info",class:"min-size-4 text-primary"}),e[3]||(e[3]=a("span",null,"На данный момент нет отзывов. Вернитесь позже",-1))])):_("",!0),!t.loading&&t.reviews!==null?(l(),$(V,{key:2,class:"w-full",modelValue:t.filter.status,"onUpdate:modelValue":[e[1]||(e[1]=w=>t.filter.status=w),g.handleTabChange]},{default:o(()=>[s(k,{class:"bg-gray-200/80 mb-5"},{default:o(()=>[s(b,{value:"moderation"},{default:o(()=>[e[4]||(e[4]=d(" На модерации ")),t.filter.status==="moderation"?(l(),p(f,{key:0},[d(" ("+m(t.pagination.total)+") ",1)],64)):_("",!0)]),_:1,__:[4]}),s(b,{value:"approved"},{default:o(()=>[e[5]||(e[5]=d(" Опубликовано ")),t.filter.status==="approved"?(l(),p(f,{key:0},[d(" ("+m(t.pagination.total)+") ",1)],64)):_("",!0)]),_:1,__:[5]}),s(b,{value:"failed"},{default:o(()=>[e[6]||(e[6]=d(" Провален ")),t.filter.status==="failed"?(l(),p(f,{key:0},[d(" ("+m(t.pagination.total)+") ",1)],64)):_("",!0)]),_:1,__:[6]})]),_:1}),s(M,{data:t.reviews,onUpdate:g.getAll},null,8,["data","onUpdate"]),t.pagination.total>t.pagination.itemsPerPage?(l(),$(B,{key:0,page:t.pagination.page,"onUpdate:page":[e[0]||(e[0]=w=>t.pagination.page=w),g.handlePageChange],"items-per-page":t.pagination.itemsPerPage,total:t.pagination.total,"default-page":t.pagination.page},{default:o(({page:w})=>[s(I,null,{default:o(({items:j})=>[s(T,{class:"hover:bg-gray-200"}),(l(!0),p(f,null,U(j,(y,A)=>(l(),p(f,{key:A},[y.type==="page"?(l(),$(h,{key:0,value:y.value,"is-active":y.value===w,class:"hover:bg-gray-200"},{default:o(()=>[d(m(y.value),1)]),_:2},1032,["value","is-active"])):_("",!0)],64))),128)),s(C,{index:4}),s(S,{class:"hover:bg-gray-200"})]),_:2},1024)]),_:1},8,["page","items-per-page","total","default-page","onUpdate:page"])):_("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])):_("",!0)],64)}const _t=K(tt,[["render",nt]]);export{_t as default};
